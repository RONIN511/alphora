<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
<title>AgentChat · Powered by Alphora</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Source+Code+Pro:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css" id="hljs-light">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark-dimmed.min.css" id="hljs-dark" disabled>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
<style>
/* ===== DESIGN TOKENS ===== */
:root {
  --white:#fff;--bg:#f8fafc;--bg2:#f1f5f9;--bg3:#e2e8f0;
  --border:#e2e8f0;--blt:#f1f5f9;
  --t1:#0f172a;--t2:#334155;--t3:#64748b;--t4:#94a3b8;--t5:#cbd5e1;
  --accent:#6366f1;--accent-h:#4f46e5;--abg:#eef2ff;
  --green:#10b981;--red:#ef4444;--amber:#f59e0b;
  --font:'DM Sans','Noto Sans SC',system-ui,-apple-system,sans-serif;
  --mono:'Source Code Pro','Fira Code',ui-monospace,monospace;
  --shadow-xs:0 1px 2px rgba(0,0,0,.03);
  --shadow-sm:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow-md:0 4px 6px -1px rgba(0,0,0,.07),0 2px 4px -2px rgba(0,0,0,.05);
  --shadow-lg:0 10px 15px -3px rgba(0,0,0,.08),0 4px 6px -4px rgba(0,0,0,.04);
  --nav-h:0px;
  --bg-grad:linear-gradient(135deg,#f8fafc 0%,#eef2ff 100%)
}
/* === DARK MODE === */
[data-theme="dark"] {
  --white:#1a1a1a;--bg:#242424;--bg2:#2e2e2e;--bg3:#3a3a3a;
  --border:#2e2e2e;--blt:#202020;
  --t1:#ffffff;--t2:#e0e0e0;--t3:#8c8c8c;--t4:#606060;--t5:#404040;
  --accent:#818cf8;--accent-h:#6366f1;--abg:rgba(99,102,241,.12);
  --green:#34d399;--red:#f87171;--amber:#fbbf24;
  --shadow-xs:0 1px 2px rgba(0,0,0,.25);
  --shadow-sm:0 1px 3px rgba(0,0,0,.3),0 1px 2px rgba(0,0,0,.25);
  --shadow-md:0 4px 6px -1px rgba(0,0,0,.4),0 2px 4px -2px rgba(0,0,0,.3);
  --shadow-lg:0 10px 15px -3px rgba(0,0,0,.5),0 4px 6px -4px rgba(0,0,0,.35);
  --bg-grad:linear-gradient(135deg,#1a1a1a 0%,#1e1e1e 100%)
}
/* ===== RESETS ===== */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;width:100%;overflow:hidden;background:var(--bg-grad);color:var(--t1);font-family:var(--font);font-size:14px;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transition:background .3s,color .3s}
button{font-family:inherit;cursor:pointer;border:none;background:none;outline:none}
input,select,textarea{font-family:inherit;outline:none}
::selection{background:var(--abg);color:var(--accent)}

/* ===== APP SHELL ===== */
#app{width:100%;height:100vh;display:flex;flex-direction:column;overflow:hidden}
#nav{display:none}

/* Sidebar brand */
.sb-brand{display:flex;align-items:center;gap:10px;padding:18px 16px 14px;user-select:none;border-bottom:1px solid rgba(0,0,0,.04);margin-bottom:2px}
[data-theme="dark"] .sb-brand{border-bottom-color:rgba(255,255,255,.04)}
.sb-brand img{width:26px;height:26px;border-radius:7px;object-fit:contain}
.sb-brand span{font-size:15px;font-weight:700;color:var(--t1);letter-spacing:-.3px;flex:1 1 0%}

/* Sidebar footer */
.sb-footer{padding:8px 8px 12px;border-top:1px solid rgba(0,0,0,.06);flex:0 0 auto;display:flex;flex-direction:column;gap:1px}
[data-theme="dark"] .sb-footer{border-top-color:rgba(255,255,255,.06)}
.sb-fi{display:flex;align-items:center;gap:9px;padding:9px 12px;border-radius:10px;font-size:13px;color:var(--t3);cursor:pointer;transition:all .2s ease}
.sb-fi:hover{background:rgba(0,0,0,.04);color:var(--t1)}
[data-theme="dark"] .sb-fi:hover{background:rgba(255,255,255,.06);color:var(--t2)}
.sb-fi svg{width:16px;height:16px;opacity:.55;flex:0 0 16px}
.sb-fi.on{color:var(--accent)}
.sb-fi.on svg{opacity:.85}

/* Expand button (floating when sidebar collapsed) */
.sb-toggle{position:fixed;top:14px;left:14px;display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;color:var(--t4);transition:all .2s ease;z-index:110;background:var(--white);border:1px solid var(--border);box-shadow:var(--shadow-sm)}
.sb-toggle:hover{background:var(--bg);color:var(--t2)}
.sb-toggle svg{width:18px;height:18px}

/* ===== BODY ===== */
#body{flex:1 1 0%;display:flex;flex-direction:row;overflow:hidden}
.pages{flex:1 1 0%;position:relative;overflow:hidden;min-width:0}
.pg{position:absolute;top:0;left:0;right:0;bottom:0;visibility:hidden;pointer-events:none;opacity:0;transition:opacity .2s ease}
.pg[data-on="1"]{visibility:visible;pointer-events:auto;opacity:1}

/* ===== CHAT PAGE ===== */
.pg-chat{display:flex;flex-direction:column}

/* Sidebar */
.hsb{width:260px;flex:0 0 260px;background:rgba(248,250,252,.55);backdrop-filter:blur(24px) saturate(180%);-webkit-backdrop-filter:blur(24px) saturate(180%);border-right:1px solid rgba(226,232,240,.5);display:flex;flex-direction:column;transition:width .35s cubic-bezier(.22,1,.36,1),flex .35s cubic-bezier(.22,1,.36,1),opacity .25s ease,background .3s}
[data-theme="dark"] .hsb{background:rgba(32,32,32,.55);border-right-color:rgba(46,46,46,.6)}
.hsb.collapsed{width:0;flex:0 0 0;opacity:0;overflow:hidden;border-right:none}
.hsh{padding:4px 16px 8px;display:flex;align-items:center;justify-content:space-between;flex:0 0 auto}
.hsh h3{font-size:12px;font-weight:600;color:var(--t3)}
.hsh-acts{display:flex;align-items:center;gap:2px}
.sb{display:flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:8px;color:var(--t3);transition:all .2s ease}
.sb:hover{background:rgba(0,0,0,.06);color:var(--accent)}
[data-theme="dark"] .sb:hover{background:rgba(255,255,255,.08)}
.sb svg{width:15px;height:15px}
.hsl{flex:1 1 0%;overflow-y:auto;padding:6px 8px 10px}
.hsl::-webkit-scrollbar{width:3px}
.hsl::-webkit-scrollbar-thumb{background:rgba(0,0,0,.08);border-radius:4px}
[data-theme="dark"] .hsl::-webkit-scrollbar-thumb{background:rgba(255,255,255,.08)}
.hi{display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;font-size:13.5px;color:var(--t3);cursor:pointer;transition:all .2s ease;margin-bottom:2px}
.hi:hover{background:rgba(0,0,0,.04);color:var(--t1)}
[data-theme="dark"] .hi:hover{background:rgba(255,255,255,.06)}
.hi.on{background:var(--accent);color:#fff;font-weight:500;box-shadow:0 2px 8px rgba(99,102,241,.25)}
[data-theme="dark"] .hi.on{background:var(--accent);color:#fff}
.hit{flex:1 1 0%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hid{display:none;flex:0 0 22px;height:22px;align-items:center;justify-content:center;border-radius:6px;color:var(--t4);font-size:12px;transition:all .15s}
.hi:hover .hid{display:flex}
.hi.on .hid{color:rgba(255,255,255,.6)}
.hi.on:hover .hid{display:flex}
.hid:hover{color:var(--red);background:rgba(239,68,68,.12)}
.hi.on .hid:hover{color:#fff;background:rgba(255,255,255,.2)}

/* Chat main */
.cmain{flex:1 1 0%;display:flex;flex-direction:column;min-width:0;overflow:hidden;background:var(--white);transition:background .3s}
.msgs{flex:1 1 0%;overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth}
.msgs::-webkit-scrollbar{width:6px}
.msgs::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
/* Empty chat: center everything vertically */
.pg-chat.empty .cmain{justify-content:center;padding-bottom:6vh}
.pg-chat.empty .msgs{flex:0 0 auto;overflow:visible}
.pg-chat.empty .wl{height:auto;padding:0 0 10px}
.pg-chat.empty .ina{flex:0 0 auto}
.pg-chat.empty .inh{display:none}
.pg-chat.empty .inw{max-width:780px}
.pg-chat.empty .inb{border-radius:18px;box-shadow:var(--shadow-md);border:1px solid var(--border)}
.pg-chat.empty .inr{padding:18px 16px 18px 22px;min-height:110px;align-items:flex-start}
.pg-chat.empty .ita{min-height:70px;font-size:15px}
.pg-chat.empty .iac{align-self:flex-end}
.pg-chat.empty .wl-foot{display:block;margin-top:14px}

/* Welcome screen */
.wl{display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-end;height:100%;padding:40px 28px 16px;max-width:780px;margin:0 auto;width:100%}
.wl-hero{display:flex;align-items:center;gap:16px}
.wl-logo{width:64px;height:64px;border-radius:14px;overflow:hidden;flex:0 0 64px}
.wl-logo img{width:100%;height:100%;object-fit:contain}
.wl-hero-text{display:flex;flex-direction:column;gap:2px}
.wl-greeting-text{font-size:28px;font-weight:600;color:var(--t2);line-height:1.2}
.wl-headline{font-size:32px;font-weight:700;letter-spacing:-.5px;line-height:1.25;background:linear-gradient(90deg,var(--accent) 0%,#a855f7 50%,#ec4899 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;min-height:1.25em}
.wl-cursor{display:inline-block;width:2px;height:.9em;background:var(--accent);margin-left:2px;vertical-align:text-bottom;animation:cur-blink .6s steps(2) infinite}
@keyframes cur-blink{0%{opacity:1}100%{opacity:0}}
.wl-foot{display:none;color:var(--t4);font-size:12px;line-height:1.7;text-align:center;max-width:780px;margin:0 auto;width:100%;padding:0 28px}

/* Messages */
.msg{padding:16px 0;position:relative;animation:mi .35s cubic-bezier(.21,1.02,.73,1)}
.msg+.msg{border-top:none}
@keyframes mi{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.mi{max-width:800px;margin:0 auto;padding:0 32px;display:flex;gap:0}
.msg.user .mi{justify-content:flex-end}
.msg.user .mb{color:var(--t1);padding:10px 16px;max-width:33%;word-break:break-word;font-size:14px;line-height:1.7;background:var(--bg);border-radius:18px 18px 4px 18px;width:fit-content;margin-left:auto;flex:0 1 auto}
.msg.assistant .mi{align-items:flex-start}
.mav{display:none}
.mb{flex:1 1 0%;min-width:0}
.mt{font-size:11px;color:var(--t5);max-width:800px;margin:4px auto 0;padding:0 32px}
.mfs{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.mfc{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;background:var(--bg);border:1px solid var(--border);border-radius:8px;font-size:12px;color:var(--t2)}

/* Msg hover actions */
.macts{display:none;position:absolute;top:16px;right:16px;background:var(--white);border:1px solid var(--border);border-radius:8px;box-shadow:var(--shadow-md);padding:3px;gap:2px;z-index:5}
.msg.assistant:hover .macts{display:flex}
.mab{display:flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:6px;color:var(--t4);transition:all .15s ease}
.mab:hover{color:var(--accent);background:var(--abg)}
.mab svg{width:14px;height:14px}

/* Content blocks */
.cb{margin:8px 0;border-radius:12px;overflow:hidden;word-break:break-word}
.cb:first-child{margin-top:0}
.cbl{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:600;color:var(--t4);text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px;user-select:none}
.cbl.clk{cursor:pointer;border-radius:6px;padding:3px 8px;margin-left:-8px;transition:all .15s}
.cbl.clk:hover{background:var(--bg);color:var(--t3)}
.cbl .ar{font-size:9px;transition:transform .25s ease;display:inline-block}
.cbl .ar.d{transform:rotate(0)}.cbl .ar.r{transform:rotate(-90deg)}
.cbd{overflow:hidden;transition:max-height .35s ease,opacity .25s ease,padding .3s ease}
.cbd.col{max-height:0!important;opacity:0;padding:0!important}

/* Code copy */
.cw{position:relative}
.cc{position:absolute;top:10px;right:10px;padding:4px 10px;background:rgba(255,255,255,.9);border:1px solid var(--border);border-radius:6px;font-size:11px;font-weight:500;color:var(--t3);opacity:0;transition:all .2s ease;backdrop-filter:blur(4px);z-index:2;cursor:pointer}
[data-theme="dark"] .cc{background:rgba(36,36,36,.9)}
.cw:hover .cc{opacity:1}
.cc:hover{color:var(--accent);border-color:var(--accent)}
.cc.ok{color:var(--green);border-color:var(--green)}

/* Markdown */
.md h1,.md h2,.md h3,.md h4{margin:16px 0 8px;font-weight:600;color:var(--t1)}
.md h1{font-size:1.4em}.md h2{font-size:1.25em}.md h3{font-size:1.1em}
.md p{margin:6px 0;line-height:1.7}.md ul,.md ol{padding-left:22px;margin:6px 0}.md li{margin:3px 0}
.md code{font-family:var(--mono);background:var(--bg2);padding:2px 6px;border-radius:5px;font-size:.87em;color:var(--accent)}
.md pre{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 16px;overflow-x:auto;margin:10px 0}
.md pre code{background:none;padding:0;font-size:13px;line-height:1.6;color:var(--t1)}
.md a{color:var(--accent);text-decoration:none;font-weight:500;transition:color .15s}.md a:hover{color:var(--accent-h);text-decoration:underline}
.md blockquote{border-left:3px solid var(--accent);padding:8px 16px;color:var(--t2);margin:10px 0;background:var(--abg);border-radius:0 8px 8px 0}
.md table{border-collapse:collapse;width:100%;margin:10px 0;font-size:13px;border-radius:8px;overflow:hidden}
.md th,.md td{border:1px solid var(--border);padding:8px 12px;text-align:left}
.md th{background:var(--bg);font-weight:600}
.md img{max-width:100%;border-radius:12px}
.md hr{border:none;height:1px;background:var(--border);margin:16px 0}

/* Streaming cursor */
.sdot::after{content:'';display:inline-block;width:7px;height:18px;background:var(--accent);border-radius:2px;margin-left:3px;animation:blink 1s steps(2) infinite;vertical-align:text-bottom}
@keyframes blink{0%{opacity:1}100%{opacity:0}}

/* Input area */
.ina{padding:12px 32px 20px;flex:0 0 auto}
.inw{max-width:800px;margin:0 auto}
.inb{background:var(--white);border:1.5px solid var(--border);border-radius:16px;transition:all .25s ease;box-shadow:var(--shadow-sm)}
.inb:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(99,102,241,.1),var(--shadow-md)}
.inb.dov{border-color:var(--accent);background:var(--abg)}
.fp{display:flex;flex-wrap:wrap;gap:5px;padding:10px 14px 0}
.fp:empty{display:none}
.ft{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;background:var(--bg);border-radius:8px;font-size:12px;color:var(--t2)}
.ftx{color:var(--t4);font-size:14px;cursor:pointer;line-height:1;transition:color .15s}.ftx:hover{color:var(--red)}
.inr{display:flex;align-items:flex-end;padding:10px 10px 10px 16px;gap:6px}
.ita{flex:1 1 0%;border:none;background:transparent;color:var(--t1);font-size:14px;line-height:1.6;resize:none;min-height:24px;max-height:180px;padding:4px 0;font-family:inherit}
.ita::placeholder{color:var(--t4)}
.iac{display:flex;align-items:center;gap:2px;flex:0 0 auto}
.ib{width:36px;height:36px;display:flex;align-items:center;justify-content:center;color:var(--t4);border-radius:8px;transition:all .2s ease}
.ib:hover{background:var(--bg);color:var(--t2)}
.ib svg{width:17px;height:17px}
.sbtn{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),#a855f7);color:var(--white);border-radius:10px;transition:all .2s ease;box-shadow:0 2px 8px rgba(99,102,241,.3)}
.sbtn:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(99,102,241,.4)}
.sbtn:disabled{background:var(--bg3);color:var(--t4);cursor:not-allowed;box-shadow:none;transform:none}
.sbtn svg{width:15px;height:15px}
.sbtn.stop-btn{background:linear-gradient(135deg,var(--red),#f97316);box-shadow:0 2px 8px rgba(239,68,68,.3)}
.sbtn.stop-btn:hover{box-shadow:0 4px 12px rgba(239,68,68,.4)}
.inh{text-align:center;padding:6px 0 0;font-size:11px;color:var(--t5)}

/* Terminal panel */
.tp{position:fixed;top:0;right:0;width:440px;height:100vh;background:#0f172a;transform:translateX(100%);transition:transform .4s cubic-bezier(.22,1,.36,1);z-index:50;display:flex;flex-direction:column;box-shadow:-4px 0 24px rgba(0,0,0,.15)}
.tp.open{transform:translateX(0)}
.tbar{display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:44px;flex:0 0 44px;background:#0a0f1e;border-bottom:1px solid #1e293b}
.tbar h3{font-size:12px;font-weight:600;color:#64748b;font-family:var(--mono);display:flex;align-items:center;gap:10px}
.td{display:flex;gap:6px}.tdd{width:11px;height:11px;border-radius:50%}.tdd.r{background:#ff5f57}.tdd.y{background:#febc2e}.tdd.g{background:#28c840}
.tc{color:#475569;font-size:18px;padding:4px;transition:color .15s}.tc:hover{color:#e2e8f0}
.tbd{flex:1 1 0%;overflow-y:auto;padding:14px 16px;font-family:var(--mono);font-size:13px;line-height:1.6;color:#e2e8f0;white-space:pre-wrap;word-break:break-all}
.tbd::-webkit-scrollbar{width:5px}.tbd::-webkit-scrollbar-thumb{background:#334155;border-radius:3px}
.tl{margin:2px 0;padding:2px 0}.tl.cmd{color:#4ade80}.tl.err{color:#f87171}

/* API popover */
.apop{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--white);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow-lg);padding:22px;width:400px;z-index:200;display:none;animation:apopIn .25s ease}
.apop-overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);z-index:199;display:none}
.apop-overlay.open{display:block}
.apop h4{font-size:14px;font-weight:600;color:var(--t1);margin-bottom:14px}
.apop.open{display:block}
@keyframes apopIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:none}}
.ar2{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.ar2:last-of-type{margin-bottom:0}
.ar2 label{font-size:12px;color:var(--t3);width:64px;flex:0 0 64px;font-weight:600}
.ar2 input,.ar2 select{flex:1 1 0%;height:34px;padding:0 10px;background:var(--bg);border:1px solid var(--border);border-radius:8px;font-size:12px;color:var(--t1);font-family:var(--mono);transition:border-color .2s}
.ar2 input:focus{border-color:var(--accent)}
.anote{font-size:11px;color:var(--t3);margin-top:12px;line-height:1.7;background:var(--bg);padding:10px 12px;border-radius:10px}
.anote code{font-family:var(--mono);background:var(--white);padding:1px 5px;border-radius:4px;font-size:10px;border:1px solid var(--border)}

/* ===== STUDIO PAGE ===== */
.pg-stu{display:flex;flex-direction:row;background:var(--bg)}
.stside{width:210px;flex:0 0 210px;background:var(--white);border-right:1px solid var(--border);display:flex;flex-direction:column}
.stsh{padding:16px 16px 12px;border-bottom:1px solid var(--border);flex:0 0 auto}
.stsh h3{font-size:11px;font-weight:700;color:var(--t4);text-transform:uppercase;letter-spacing:.8px}
.stl{flex:1 1 0%;overflow-y:auto;padding:8px 10px}
.stl::-webkit-scrollbar{width:4px}.stl::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.si{display:flex;align-items:center;gap:7px;padding:8px 12px;font-size:13px;color:var(--t2);cursor:pointer;border-radius:8px;border-left:3px solid transparent;transition:all .15s;margin-bottom:2px}
.si:hover{background:var(--bg);color:var(--t1)}
.si.on{background:var(--abg);color:var(--accent);border-left-color:var(--accent);font-weight:500}
.sii{font-size:11px;width:18px;text-align:center;flex:0 0 18px}
.siad{color:var(--accent);font-weight:500}
.stf{padding:10px;border-top:1px solid var(--border);flex:0 0 auto;display:flex;flex-direction:column;gap:3px}
.sfb{display:flex;align-items:center;gap:7px;padding:8px 12px;font-size:12px;font-weight:500;color:var(--t3);border-radius:8px;transition:all .15s}
.sfb:hover{background:var(--bg);color:var(--t1)}
.sfb svg{width:14px;height:14px;opacity:.5}

/* Studio editor */
.sted{flex:1 1 0%;overflow-y:auto;padding:28px 32px;min-width:0}
.sted::-webkit-scrollbar{width:6px}.sted::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.ste0{display:flex;align-items:center;justify-content:center;height:100%;color:var(--t4);font-size:14px}
.ss{margin-bottom:28px}
.ss h4{font-size:11px;font-weight:700;color:var(--t4);text-transform:uppercase;letter-spacing:.8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--blt)}
.sr{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.sr label{font-size:12px;color:var(--t2);width:85px;flex:0 0 85px;font-weight:500}
.sr input[type="text"],.sr select{flex:1 1 0%;height:34px;padding:0 12px;background:var(--white);border:1px solid var(--border);color:var(--t1);border-radius:8px;font-size:12px;transition:border-color .2s}
.sr input:focus,.sr select:focus{border-color:var(--accent)}
.pls{display:flex;gap:4px;flex:1 1 0%;flex-wrap:wrap}
.pl{padding:6px 14px;font-size:12px;border:1px solid var(--border);background:var(--white);color:var(--t2);border-radius:8px;font-weight:500;transition:all .15s}
.pl:hover{border-color:var(--t4)}
.pl.on{background:var(--accent);border-color:var(--accent);color:var(--white)}
.pgr{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px}
.pc{padding:10px 12px;border:1.5px solid var(--border);border-radius:10px;cursor:pointer;transition:all .15s;text-align:center;background:var(--white)}
.pc:hover{border-color:var(--t4);transform:translateY(-1px)}
.pc.on{border-color:var(--accent);background:var(--abg)}
.pcn{font-size:12px;font-weight:600;color:var(--t1)}.pcd{font-size:10px;color:var(--t3);margin-top:2px}
.ag{margin-bottom:12px}.agt{font-size:11px;color:var(--t3);margin-bottom:5px;font-weight:500}
.acs{display:flex;flex-wrap:wrap;gap:5px}
.ac{padding:4px 10px;font-size:11px;border:1px solid var(--border);border-radius:999px;cursor:pointer;color:var(--t2);background:var(--white);transition:all .15s;font-family:var(--mono)}
.ac:hover{border-color:var(--t4)}
.ac.on{background:var(--accent);border-color:var(--accent);color:var(--white)}

/* Studio preview */
.stpv{width:380px;flex:0 0 380px;background:var(--white);border-left:1px solid var(--border);display:flex;flex-direction:column}
.stph{padding:16px 20px 12px;border-bottom:1px solid var(--border);flex:0 0 auto}
.stph h3{font-size:11px;font-weight:700;color:var(--t4);text-transform:uppercase;letter-spacing:.8px}
.stpb{flex:1 1 0%;overflow-y:auto;padding:24px 20px}
.pml{font-size:11px;color:var(--t5);margin-bottom:12px;font-weight:500}
.pmm{display:flex;gap:12px;align-items:flex-start}
.pma{width:24px;height:24px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#a855f7);flex:0 0 24px;margin-top:2px}
.pmc{flex:1 1 0%;min-width:0}

/* Toast */
.tw{position:fixed;bottom:28px;right:28px;z-index:9999;display:flex;flex-direction:column-reverse;gap:8px;pointer-events:none}
.to{padding:12px 20px;background:var(--t1);color:var(--white);font-size:13px;font-weight:500;border-radius:12px;box-shadow:var(--shadow-lg);animation:ti .35s cubic-bezier(.21,1.02,.73,1);max-width:340px;pointer-events:auto;display:flex;align-items:center;gap:8px}
.to.ok{background:#059669}.to.err{background:var(--red)}
.to .to-icon{font-size:16px;line-height:1}
@keyframes ti{from{opacity:0;transform:translateY(10px) scale(.95)}to{opacity:1;transform:none}}

/* Loading dots animation for pending response */
.loading-dots{display:inline-flex;gap:3px;padding:8px 4px}
.loading-dots span{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:ld .6s ease-in-out infinite}
.loading-dots span:nth-child(2){animation-delay:.15s}
.loading-dots span:nth-child(3){animation-delay:.3s}
@keyframes ld{0%,100%{opacity:.3;transform:scale(.8)}50%{opacity:1;transform:scale(1)}}

/* Responsive */
@media(max-width:900px){
  .hsb{display:none!important}.tp{width:100vw}.sb-toggle{display:none!important}
  .mi{padding:0 16px}.ina{padding:8px 12px 14px}
  .macts{display:none!important}
  .stpv{display:none}.stside{width:170px;flex:0 0 170px}
  .pgr{grid-template-columns:1fr 1fr}
  .mt{padding:0 16px 0 58px}
  .apop{width:calc(100vw - 32px);max-width:400px}
  .wsc-r{grid-template-columns:1fr;max-width:280px}
  .wl h2{font-size:22px}
}
@media(max-width:640px){
  .wsc-r{grid-template-columns:1fr}
  .inr{padding:8px}
}
</style>
</head>
<body>
<div id="app">
<div id="nav"></div>
<button class="sb-toggle" id="bExpand" title="展开侧栏" style="display:none"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
<div class="apop-overlay" id="apopOverlay"></div>
<div class="apop" id="apop">
  <h4>API 设置</h4>
  <div class="ar2"><label>Host</label><input id="cfgHost" value="" placeholder="http://127.0.0.1:8000"></div>
  <div class="ar2"><label>Path</label><input id="cfgPath" value="/alphadata/chat/completions" placeholder="/alphadata/chat/completions"></div>
  <div class="ar2"><label>Model</label><input id="cfgModel" value="" placeholder="model name"></div>
  <div class="ar2"><label>Stream</label><select id="cfgStream"><option value="true" selected>Yes</option><option value="false">No</option></select></div>
  <div class="anote"><strong>跨域？</strong> 用 <code>python serve.py --api http://IP:PORT</code> 启动，Host 留空，Path 填 <code>/api/alphadata/chat/completions</code>，自动代理转发。</div>
</div>
<div id="body">
  <!-- SIDEBAR (always visible) -->
  <div class="hsb" id="hsb">
    <div class="sb-brand"><img src="/asset/image/logo.png" alt="alphora"><span>alphora chat</span></div>
    <div class="hsh"><h3>历史对话</h3><div class="hsh-acts"><button class="sb" id="bNew" title="新对话"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button><button class="sb" id="bCollapse" title="收起侧栏"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="11 17 6 12 11 7"/><polyline points="18 17 13 12 18 7"/></svg></button></div></div>
    <div class="hsl" id="hsl"></div>
    <div class="sb-footer">
      <div class="sb-fi" id="sbApi"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>API 设置</div>
      <div class="sb-fi" id="sbRenderer"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>渲染器</div>
      <div class="sb-fi" id="sbTerminal"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>终端</div>
      <div class="sb-fi" id="sbExport"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>导出对话</div>
      <div class="sb-fi" id="sbTheme"><svg id="sbThemeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>切换主题</div>
    </div>
  </div>
  <!-- PAGES -->
  <div class="pages">
    <!-- CHAT -->
    <div class="pg pg-chat" id="pgChat" data-on="1">
      <div class="cmain">
        <div class="msgs" id="msgs"><div class="wl" id="wl">
          <div class="wl-hero">
            <div class="wl-logo"><img src="/asset/image/logo.png" alt="alphora"></div>
            <div class="wl-hero-text">
              <div class="wl-greeting-text">alphora chat</div>
              <div class="wl-headline" id="wlHL"><span class="wl-cursor"></span></div>
            </div>
          </div>
        </div></div>
        <div class="ina"><div class="inw"><div class="inb" id="inb"><div class="fp" id="fp"></div><div class="inr"><textarea class="ita" id="uIn" rows="1" placeholder="输入消息…"></textarea><div class="iac"><button class="ib" id="bAt" title="上传文件"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg></button><button class="sbtn" id="sBtn" title="发送"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div></div></div><div class="inh">Enter 发送 · Shift+Enter 换行 · 拖拽/粘贴上传文件</div></div></div>
        <div class="wl-foot" id="wlFoot">基于 Alphora 构建的智能对话界面，支持流式响应、多内容类型渲染和终端面板。</div>
        <input type="file" id="fIn" multiple style="display:none">
      </div>
    </div>
    <!-- STUDIO -->
    <div class="pg pg-stu" id="pgStu" data-on="0">
      <div class="stside"><div class="stsh"><h3>Content Types</h3></div><div class="stl" id="stl"></div><div class="stf"><button class="sfb" id="stExp"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>导出</button><button class="sfb" id="stRst"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>恢复默认</button><button class="sfb" id="stSav" style="color:var(--accent);font-weight:600"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>保存</button></div></div>
      <div class="sted" id="sted"><div class="ste0">← 选择一个 content_type 开始编辑</div></div>
      <div class="stpv"><div class="stph"><h3>实时预览</h3></div><div class="stpb"><div class="pml">渲染效果</div><div class="pmm"><div class="pma"></div><div class="pmc" id="stPv"></div></div></div></div>
    </div>
  </div>
</div>
</div>
<div class="tp" id="tp"><div class="tbar"><h3><span class="td"><span class="tdd r"></span><span class="tdd y"></span><span class="tdd g"></span></span>Terminal</h3><button class="tc" id="tCl">✕</button></div><div class="tbd" id="tbd"></div></div>
<div class="tw" id="tw"></div>
<script src="renderer_config.js"></script>
<script>
(function(){
"use strict";
var $=function(i){return document.getElementById(i)};
var E=function(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML};
var G=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)};
var T=function(){return new Date().toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'})};

var msgs=$('msgs'),wl=$('wl'),wlFoot=$('wlFoot'),uIn=$('uIn'),sBtn=$('sBtn'),inb=$('inb'),fIn=$('fIn'),fp=$('fp');
var tp=$('tp'),tbd=$('tbd'),cfgHost=$('cfgHost'),cfgPath=$('cfgPath'),cfgModel=$('cfgModel'),cfgStream=$('cfgStream'),apop=$('apop');
var hsl=$('hsl'),stl=$('stl'),sted=$('sted'),stPv=$('stPv'),pgChat=$('pgChat');

var cfg=JSON.parse(JSON.stringify(window.RENDERER_CONFIG));
var cvs=[],aid=null,fls=[],strm=false,pOpen=false,eType=null,abortCtrl=null;

try{var _c=localStorage.getItem('ac_cfg');if(_c)cfg=JSON.parse(_c)}catch(e){}
try{var _h=localStorage.getItem('ac_cvs');if(_h)cvs=JSON.parse(_h)}catch(e){}
try{aid=localStorage.getItem('ac_aid')||null}catch(e){}
try{var _apiHost=localStorage.getItem('ac_api_host');if(_apiHost!=null)cfgHost.value=_apiHost}catch(e){}
try{var _apiPath=localStorage.getItem('ac_api_path');if(_apiPath)cfgPath.value=_apiPath}catch(e){}
try{var _apiModel=localStorage.getItem('ac_api_model');if(_apiModel!=null)cfgModel.value=_apiModel}catch(e){}
try{var _apiStream=localStorage.getItem('ac_api_stream');if(_apiStream!=null)cfgStream.value=_apiStream}catch(e){}
function sC(){try{localStorage.setItem('ac_cfg',JSON.stringify(cfg))}catch(e){}}
function sV(){try{localStorage.setItem('ac_cvs',JSON.stringify(cvs));localStorage.setItem('ac_aid',aid||'')}catch(e){}}
function gR(t){return cfg[t]||cfg._default||{component:'text',layout:'inline',atoms:[],style:{}}}
function cS(r){return window.resolveStyle?window.resolveStyle(r):(r.style||{})}
function setEmpty(v){
  pgChat.classList.toggle('empty',!!v);
  if(wlFoot)wlFoot.style.display=v?'':'none';
}

function saveApiCfg(){
  try{
    localStorage.setItem('ac_api_host',cfgHost.value.trim());
    localStorage.setItem('ac_api_path',cfgPath.value.trim());
    localStorage.setItem('ac_api_model',cfgModel.value.trim());
    localStorage.setItem('ac_api_stream',cfgStream.value);
  }catch(e){}
}
cfgHost.addEventListener('input',saveApiCfg);
cfgPath.addEventListener('input',saveApiCfg);
cfgModel.addEventListener('input',saveApiCfg);
cfgStream.addEventListener('change',saveApiCfg);

function toast(m,t){var e=document.createElement('div');e.className='to'+(t==='ok'?' ok':'')+(t==='err'?' err':'');e.innerHTML=(t==='ok'?'<span class="to-icon">✓</span>':t==='err'?'<span class="to-icon">✕</span>':'')+E(m);$('tw').appendChild(e);setTimeout(function(){e.style.opacity='0';e.style.transition='opacity .25s';setTimeout(function(){e.remove()},250)},2800)}

/* Dark mode */
var isDark=localStorage.getItem('ac_theme')==='dark';
function setTheme(dark){isDark=dark;document.documentElement.setAttribute('data-theme',dark?'dark':'');localStorage.setItem('ac_theme',dark?'dark':'light');$('hljs-light').disabled=dark;$('hljs-dark').disabled=!dark;
  var icon=dark?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>':'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>';
  var el=$('sbTheme');if(el)el.innerHTML=icon+(dark?'浅色模式':'深色模式')}
setTheme(isDark);
$('sbTheme').addEventListener('click',function(){setTheme(!isDark)});

/* Page switch via sidebar footer */
$('sbRenderer').addEventListener('click',function(){
  var cur=$('pgStu').getAttribute('data-on')==='1';
  if(cur){$('pgStu').setAttribute('data-on','0');$('pgChat').setAttribute('data-on','1');this.classList.remove('on')}
  else{$('pgChat').setAttribute('data-on','0');$('pgStu').setAttribute('data-on','1');this.classList.add('on');bSL()}
});

/* API popover */
var apopOverlay=$('apopOverlay');
$('sbApi').addEventListener('click',function(e){e.stopPropagation();var isOpen=apop.classList.toggle('open');apopOverlay.classList.toggle('open',isOpen)});
apopOverlay.addEventListener('click',function(){apop.classList.remove('open');apopOverlay.classList.remove('open')});
document.addEventListener('click',function(e){if(!apop.contains(e.target)&&e.target!==apopOverlay&&!$('sbApi').contains(e.target)){apop.classList.remove('open');apopOverlay.classList.remove('open')}});

/* Sidebar collapse/expand */
var hsb=$('hsb'),bExpand=$('bExpand'),sbCollapsed=false;
try{sbCollapsed=localStorage.getItem('ac_sb_col')==='1'}catch(e){}
function setSB(col){
  sbCollapsed=col;hsb.classList.toggle('collapsed',col);
  bExpand.style.display=col?'flex':'none';
  try{localStorage.setItem('ac_sb_col',col?'1':'0')}catch(e){}
}
setSB(sbCollapsed);
$('bCollapse').addEventListener('click',function(){setSB(true)});
bExpand.addEventListener('click',function(){setSB(false)});

/* Terminal */
function tgl(f){pOpen=f!==undefined?f:!pOpen;tp.classList.toggle('open',pOpen);$('sbTerminal').classList.toggle('on',pOpen)}
function tP(t,ty){if(!pOpen)tgl(true);var e=document.createElement('div');e.className='tl'+(ty==='bash'?' cmd':'')+(ty==='stderr'?' err':'');if(ty==='bash')e.innerHTML='<span style="color:#4ade80">$ </span>'+E(t);else e.textContent=t;tbd.appendChild(e);tbd.scrollTop=tbd.scrollHeight}
$('sbTerminal').addEventListener('click',function(){tgl()});
$('tCl').addEventListener('click',function(){tgl(false)});

/* Files */
function aF(fl){for(var i=0;i<fl.length;i++){var f=fl[i];if(!fls.some(function(a){return a.name===f.name&&a.size===f.size}))fls.push(f)}rF()}
function rF(){fp.innerHTML='';fls.forEach(function(f,i){var t=document.createElement('span');t.className='ft';t.innerHTML=E(f.name)+'<button class="ftx" data-i="'+i+'">✕</button>';t.querySelector('.ftx').addEventListener('click',function(){fls.splice(i,1);rF()});fp.appendChild(t)})}
function b64(f){return new Promise(function(r,j){var rd=new FileReader();rd.onload=function(){r(rd.result.split(',')[1])};rd.onerror=function(){j(new Error('r'))};rd.readAsDataURL(f)})}
inb.addEventListener('dragover',function(e){e.preventDefault();inb.classList.add('dov')});
inb.addEventListener('dragleave',function(){inb.classList.remove('dov')});
inb.addEventListener('drop',function(e){e.preventDefault();inb.classList.remove('dov');if(e.dataTransfer.files.length)aF(e.dataTransfer.files)});
$('bAt').addEventListener('click',function(){fIn.click()});
fIn.addEventListener('change',function(){if(fIn.files.length)aF(fIn.files);fIn.value=''});
uIn.addEventListener('paste',function(e){var it=e.clipboardData?e.clipboardData.items:null;if(!it)return;var fs=[];for(var i=0;i<it.length;i++)if(it[i].kind==='file')fs.push(it[i].getAsFile());if(fs.length)aF(fs)});

function sB(){requestAnimationFrame(function(){msgs.scrollTop=msgs.scrollHeight})}

/* History */
function cC(){return cvs.find(function(c){return c.id===aid})}
function nC(){var c={id:G(),title:'新对话',messages:[],ts:Date.now()};cvs.unshift(c);aid=c.id;sV();rH();clr();return c}
function dC(id){cvs=cvs.filter(function(c){return c.id!==id});if(aid===id){aid=cvs.length?cvs[0].id:null;if(aid)lC(aid);else{clr();wl.style.display=''}}sV();rH()}
function lC(id){aid=id;sV();rH();var c=cC();if(!c)return;msgs.innerHTML='';msgs.appendChild(wl);if(!c.messages.length){wl.style.display='';setEmpty(true);return}wl.style.display='none';setEmpty(false);c.messages.forEach(function(m){if(m.role==='user')uD(m.content,m.files);else aD(m.content)});sB()}
function clr(){msgs.innerHTML='';msgs.appendChild(wl);wl.style.display='';setEmpty(true);tbd.innerHTML=''}
function rH(){
  hsl.innerHTML='';
  if(!cvs.length){hsl.innerHTML='<div style="padding:24px 12px;font-size:12px;color:var(--t4);text-align:center;line-height:1.8">暂无对话<br><span style="font-size:11px;color:var(--t5)">点击 + 开始新对话</span></div>';return}
  cvs.forEach(function(c){var e=document.createElement('div');e.className='hi'+(c.id===aid?' on':'');e.innerHTML='<span class="hit">'+E(c.title)+'</span><span class="hid" title="删除">✕</span>';e.querySelector('.hit').addEventListener('click',function(){lC(c.id)});e.querySelector('.hid').addEventListener('click',function(ev){ev.stopPropagation();dC(c.id)});hsl.appendChild(e)});
}
$('bNew').addEventListener('click',function(){nC()});
rH();if(aid&&cvs.find(function(c){return c.id===aid}))lC(aid);

/* Message DOM */
function uD(t,fl){
  setEmpty(false);
  wl.style.display='none';var r=document.createElement('div');r.className='msg user';
  var fh='';if(fl&&fl.length)fh='<div class="mfs">'+fl.map(function(f){return '<span class="mfc">'+E(typeof f==='string'?f:f.name)+'</span>'}).join('')+'</div>';
  r.innerHTML='<div class="mi"><div class="mb">'+fh+E(typeof t==='string'?t:'')+'</div></div>';msgs.appendChild(r);sB();
}
function aD(t){
  setEmpty(false);
  wl.style.display='none';var r=document.createElement('div');r.className='msg assistant';
  r.innerHTML='<div class="mi"><div class="mav"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div><div class="mb md"></div></div><div class="mt">'+T()+'</div>';
  var bd=r.querySelector('.mb');try{bd.innerHTML=marked.parse(t,{breaks:true,gfm:true});bd.querySelectorAll('pre code').forEach(function(b){hljs.highlightElement(b)});aCB(bd)}catch(e){bd.textContent=t}msgs.appendChild(r);sB();
}
function cBub(){
  setEmpty(false);
  wl.style.display='none';var r=document.createElement('div');r.className='msg assistant';
  r.innerHTML='<div class="macts"><button class="mab mcp" title="复制"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></div><div class="mi"><div class="mav"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div><div class="mb"><div class="loading-dots"><span></span><span></span><span></span></div></div></div><div class="mt">'+T()+'</div>';
  msgs.appendChild(r);sB();var bd=r.querySelector('.mb');
  r.querySelector('.mcp').addEventListener('click',function(){navigator.clipboard.writeText(bd.textContent).then(function(){toast('已复制','ok')})});
  return bd;
}
function aCB(el){
  el.querySelectorAll('pre').forEach(function(pre){if(pre.parentElement.classList.contains('cw'))return;var w=document.createElement('div');w.className='cw';pre.parentNode.insertBefore(w,pre);w.appendChild(pre);var b=document.createElement('button');b.className='cc';b.textContent='复制';b.addEventListener('click',function(){navigator.clipboard.writeText(pre.textContent).then(function(){b.textContent='已复制';b.classList.add('ok');setTimeout(function(){b.textContent='复制';b.classList.remove('ok')},1500)})});w.appendChild(b)});
  /* Auto-convert image links to inline images */
  var imgExts=/\.(png|jpg|jpeg|gif|webp|svg|bmp|ico)(\?.*)?$/i;
  el.querySelectorAll('a').forEach(function(a){
    var href=a.getAttribute('href');
    if(!href||!imgExts.test(href))return;
    var wrap=document.createElement('div');wrap.style.cssText='margin:8px 0';
    var img=document.createElement('img');img.src=href;img.alt=a.textContent||'';img.style.cssText='max-width:100%;border-radius:10px;cursor:pointer;box-shadow:var(--shadow-sm)';
    img.addEventListener('click',function(){window.open(href,'_blank')});
    var cap=document.createElement('div');cap.style.cssText='font-size:12px;color:var(--t3);margin-top:4px';cap.textContent=a.textContent||'';
    wrap.appendChild(img);if(a.textContent)wrap.appendChild(cap);
    a.parentNode.replaceChild(wrap,a);
  });
}

/* Content blocks */
function gB(ctn,ty,bks){
  if(bks[ty])return bks[ty];var rc=gR(ty);
  /* Remove loading dots on first content */
  var ld=ctn.querySelector('.loading-dots');if(ld)ld.remove();
  if(rc.layout==='panel'){bks[ty]={panel:true,rc:rc,buf:''};return bks[ty]}
  var w=document.createElement('div');w.className='cb';
  var sl=rc.icon||(rc.label&&rc.label!=='正文'&&rc.label!=='默认');
  if(sl){var lb=document.createElement('div');lb.className='cbl'+(rc.collapsible?' clk':'');lb.innerHTML=(rc.collapsible?'<span class="ar '+(rc.defaultCollapsed?'r':'d')+'">▾</span>':'')+(rc.icon?'<span>'+rc.icon+'</span>':'')+'<span>'+(rc.label||ty)+'</span>';w.appendChild(lb);if(rc.collapsible)lb.addEventListener('click',function(){var bd=lb.nextElementSibling;var ar=lb.querySelector('.ar');var cl=!bd.classList.contains('col');bd.classList.toggle('col',cl);ar.className='ar '+(cl?'r':'d')})}
  var bd=document.createElement('div');bd.className='cbd'+(rc.component==='markdown'?' md':'')+(rc.defaultCollapsed?' col':'');Object.assign(bd.style,cS(rc));if(rc.maxHeight){bd.style.maxHeight=rc.maxHeight;bd.style.overflowY='auto'}w.appendChild(bd);ctn.appendChild(w);bks[ty]={el:bd,rc:rc,buf:''};return bks[ty];
}
function pC(bi,c,s){
  if(!c)return;
  if(bi.panel){var pt=bi.rc.label==='命令'?'bash':bi.rc.label==='错误输出'?'stderr':'stdout';tP(c,pt);bi.buf+=c;return}
  bi.buf+=c;var el=bi.el,rc=bi.rc;
  switch(rc.component){
    case 'markdown':try{el.innerHTML=marked.parse(bi.buf,{breaks:true,gfm:true});el.querySelectorAll('pre code').forEach(function(b){hljs.highlightElement(b)});aCB(el)}catch(e){el.textContent=bi.buf}if(s){var la=el.lastElementChild||el;if(!la.querySelector('.sdd')){var d=document.createElement('span');d.className='sdd sdot';la.appendChild(d)}}break;
    case 'code':var pre=el.querySelector('pre');if(!pre){pre=document.createElement('pre');var cd=document.createElement('code');pre.appendChild(cd);el.innerHTML='';el.appendChild(pre)}pre.querySelector('code').textContent=bi.buf;try{hljs.highlightElement(pre.querySelector('code'))}catch(e){}el.classList.toggle('sdot',!!s);break;
    case 'terminal':el.style.fontFamily='var(--mono)';el.style.whiteSpace='pre-wrap';el.textContent=bi.buf;el.classList.toggle('sdot',!!s);break;
    case 'json':try{var o=JSON.parse(bi.buf);var p2=el.querySelector('pre');if(!p2){p2=document.createElement('pre');var c2=document.createElement('code');c2.className='language-json';p2.appendChild(c2);el.innerHTML='';el.appendChild(p2)}p2.querySelector('code').textContent=JSON.stringify(o,null,2);try{hljs.highlightElement(p2.querySelector('code'))}catch(e){}}catch(e){el.style.fontFamily='var(--mono)';el.textContent=bi.buf}el.classList.toggle('sdot',!!s);break;
    case 'html':var fr=el.querySelector('iframe');if(!fr){fr=document.createElement('iframe');fr.sandbox='allow-scripts';fr.style.cssText='width:100%;border:none;border-radius:10px;background:#fff;min-height:60px';el.innerHTML='';el.appendChild(fr)}fr.srcdoc=bi.buf;break;
    case 'image':var im=el.querySelector('img');if(!im){im=document.createElement('img');im.style.cssText='max-width:100%;border-radius:12px;box-shadow:var(--shadow-sm)';el.innerHTML='';el.appendChild(im)}im.src=bi.buf.startsWith('data:')||bi.buf.startsWith('http')?bi.buf:'data:image/png;base64,'+bi.buf.trim();break;
    case 'table':try{var d=JSON.parse(bi.buf);if(Array.isArray(d)&&d.length){var ks=Object.keys(d[0]);el.innerHTML='<table style="border-collapse:collapse;width:100%;font-size:13px;border-radius:8px;overflow:hidden"><tr>'+ks.map(function(k){return '<th style="border:1px solid var(--border);padding:8px 12px;background:var(--bg);font-weight:600;text-align:left">'+E(k)+'</th>'}).join('')+'</tr>'+d.map(function(r){return '<tr>'+ks.map(function(k){return '<td style="border:1px solid var(--border);padding:8px 12px">'+E(String(r[k]!=null?r[k]:''))+'</td>'}).join('')+'</tr>'}).join('')+'</table>'}}catch(e){el.textContent=bi.buf}break;
    default:el.textContent=bi.buf;el.classList.toggle('sdot',!!s);
  }sB();
}
function clC(c){c.querySelectorAll('.sdot').forEach(function(e){e.classList.remove('sdot')});c.querySelectorAll('.sdd').forEach(function(e){e.remove()});c.querySelectorAll('.loading-dots').forEach(function(e){e.remove()})}

/* Send */
function setSendBtn(streaming){
  if(streaming){
    sBtn.innerHTML='<svg viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>';
    sBtn.classList.add('stop-btn');sBtn.disabled=false;sBtn.title='停止生成';
  }else{
    sBtn.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>';
    sBtn.classList.remove('stop-btn');sBtn.title='发送';
  }
}
function buildUrl(){
  var host=cfgHost.value.trim();
  var path=cfgPath.value.trim()||'/alphadata/chat/completions';
  if(path && path[0]!=="/")path="/"+path;
  if(host){
    if(!/^https?:\/\//i.test(host))host='http://'+host;
    return host.replace(/\/+$/,'')+path;
  }
  return path;
}
function send(){
  var t=uIn.value.trim();if((!t&&!fls.length)||strm)return;uIn.value='';uIn.style.height='auto';
  var c=cC();if(!c)c=nC();var mf=fls.slice();fls=[];rF();uD(t,mf);
  c.messages.push({role:'user',content:t,files:mf.map(function(f){return f.name})});
  if(c.title==='新对话'&&t)c.title=t.slice(0,30);sV();rH();
  var url=buildUrl(),mod=cfgModel.value.trim(),st=cfgStream.value==='true';
  var am=c.messages.map(function(m){return{role:m.role,content:m.content}});
  var body=JSON.stringify({model:mod,messages:am,stream:st});
  strm=true;setSendBtn(true);abortCtrl=new AbortController();var bub=cBub(),bks={};
  var opts={method:'POST',headers:{'Content-Type':'application/json'},body:body,signal:abortCtrl.signal};
  (st?doSSE(url,opts,bub,bks):doJSON(url,opts,bub,bks)).catch(function(err){if(err.name!=='AbortError'){var b=gB(bub,'error',bks);pC(b,'请求失败: '+err.message,false)}else{var ld=bub.querySelector('.loading-dots');if(ld)ld.remove()}}).finally(function(){strm=false;setSendBtn(false);abortCtrl=null;clC(bub);var full='';Object.keys(bks).forEach(function(k){if(!bks[k].panel)full+=bks[k].buf+'\n'});full=full.trim();if(full){c.messages.push({role:'assistant',content:full});sV()}});
}
function doSSE(url,opts,bub,bks){
  return fetch(url,opts).then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);var rd=r.body.getReader(),dc=new TextDecoder(),bf='';
    function pump(){return rd.read().then(function(res){if(res.done)return;bf+=dc.decode(res.value,{stream:true});var ls=bf.split('\n');bf=ls.pop();
      for(var i=0;i<ls.length;i++){var l=ls[i].trim();if(!l||l.indexOf('data: ')!==0)continue;var d=l.slice(6);if(d==='[DONE]')return;
        try{var ch=JSON.parse(d).choices[0];if(!ch)continue;var dt=ch.delta||{};var ct=dt.content_type||'text';if(ch.finish_reason==='stop')return;if(dt.content){var bi=gB(bub,ct,bks);pC(bi,dt.content,true)}}catch(e){}}return pump()})}return pump()});
}
function doJSON(url,opts,bub,bks){
  return fetch(url,opts).then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.json()}).then(function(data){var ch=data.choices?data.choices[0]:null;if(!ch)return;var ct=(ch.delta?ch.delta.content_type:null)||'text';var cn=(ch.delta?ch.delta.content:null)||(ch.message?ch.message.content:null)||'';var bi=gB(bub,ct,bks);pC(bi,cn,false)});
}

/* Export */
$('sbExport').addEventListener('click',function(){var c=cC();if(!c||!c.messages.length){toast('没有对话','err');return}var md='# '+c.title+'\n\n';c.messages.forEach(function(m){md+='### '+(m.role==='user'?'用户':'助手')+'\n\n'+m.content+'\n\n---\n\n'});var a=document.createElement('a');a.href=URL.createObjectURL(new Blob([md],{type:'text/markdown'}));a.download='chat-'+c.id+'.md';a.click();toast('已导出','ok')});

/* Input */
uIn.addEventListener('keydown',function(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send()}});
uIn.addEventListener('input',function(){uIn.style.height='auto';uIn.style.height=Math.min(uIn.scrollHeight,180)+'px'});
sBtn.addEventListener('click',function(){if(strm&&abortCtrl){abortCtrl.abort();return}send()});
document.addEventListener('keydown',function(e){var m=e.metaKey||e.ctrlKey;if(m&&e.key==='k'){e.preventDefault();uIn.focus()}if(m&&e.key==='n'){e.preventDefault();nC()}});

/* ======== STUDIO ======== */
var MK={text:"示例文本。The quick brown fox jumps over the lazy dog.",markdown:"## 标题\n\n**粗体**正文，含 `代码`。\n\n- 列表一\n- 列表二\n\n> 引用\n\n```python\ndef hello():\n    print('world')\n```",code:"async function fetch(url) {\n  const res = await fetch(url);\n  return await res.json();\n}",terminal:"$ pip install pandas\nCollecting pandas\nSuccessfully installed pandas-2.2.0",json:'{"status":"ok","data":{"count":42}}',html:"<p>HTML</p>",image:"",table:'[{"Name":"Alice","Score":95},{"Name":"Bob","Score":87}]',hidden:"(hidden)"};
var AC=[{t:'字体大小',a:['text-xs','text-sm','text-base','text-lg','text-xl']},{t:'字重',a:['font-light','font-normal','font-medium','font-semibold','font-bold']},{t:'字体族',a:['font-sans','font-mono','font-serif']},{t:'文字颜色',a:['color-primary','color-secondary','color-muted','color-accent','color-success','color-warning','color-danger','color-white','color-term-green','color-term-gray','color-term-red']},{t:'背景色',a:['bg-none','bg-white','bg-gray-50','bg-gray-100','bg-gray-900','bg-blue-50','bg-green-50','bg-amber-50','bg-red-50','bg-purple-50']},{t:'内边距',a:['p-0','p-2','p-3','p-4','p-5']},{t:'圆角',a:['rounded-none','rounded-sm','rounded-md','rounded-lg']},{t:'边框',a:['border','border-l-blue','border-l-green','border-l-amber','border-l-red','border-l-purple','border-l-gray']},{t:'行高',a:['leading-tight','leading-normal','leading-relaxed']},{t:'其他',a:['italic','not-italic','shadow-sm','shadow']}];

function bSL(){
  stl.innerHTML='';var ts=Object.keys(cfg).filter(function(k){return k!=='_default'});ts.unshift('_default');
  ts.forEach(function(t){var rc=cfg[t];var e=document.createElement('div');e.className='si'+(t===eType?' on':'');e.innerHTML='<span class="sii">'+(rc.icon||'·')+'</span><span>'+(t==='_default'?'default':t)+'</span>';e.addEventListener('click',function(){eST(t)});stl.appendChild(e)});
  var ad=document.createElement('div');ad.className='si siad';ad.innerHTML='<span class="sii">+</span><span>添加</span>';
  ad.addEventListener('click',function(){var n=prompt('content_type:');if(n&&!cfg[n]){cfg[n]=JSON.parse(JSON.stringify(cfg._default));cfg[n].label=n;bSL();eST(n)}});stl.appendChild(ad);
}

function eST(ty){
  eType=ty;bSL();var rc=cfg[ty],cur={};(rc.atoms||[]).forEach(function(a){cur[a]=true});
  var h='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px"><div style="font-size:20px;font-weight:700;letter-spacing:-.4px">'+(ty==='_default'?'default':E(ty))+'<span style="margin-left:10px;font-size:13px;font-weight:400;color:var(--t3)">'+E(rc.label||'')+'</span></div>'+(ty!=='_default'?'<button id="stDl" style="font-size:12px;color:var(--red);padding:5px 12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s">删除</button>':'')+'</div>';
  h+='<div class="ss"><h4>基础配置</h4><div class="sr"><label>Label</label><input type="text" data-f="label" value="'+E(rc.label||'')+'"></div><div class="sr"><label>Icon</label><input type="text" data-f="icon" value="'+E(rc.icon||'')+'" style="width:60px;flex:none" placeholder="emoji"></div><div class="sr"><label>组件</label><select data-f="component">'+['text','markdown','code','terminal','json','html','image','table','hidden'].map(function(c){return '<option'+(rc.component===c?' selected':'')+'>'+c+'</option>'}).join('')+'</select></div><div class="sr"><label>布局</label><div class="pls">'+['inline','panel'].map(function(l){return '<button class="pl'+(rc.layout===l?' on':'')+'" data-ly="'+l+'">'+(l==='inline'?'💬 对话':'📟 面板')+'</button>'}).join('')+'</div></div><div class="sr"><label>可折叠</label><div class="pls"><button class="pl'+(rc.collapsible?' on':'')+'" data-bl="collapsible" data-bv="true">是</button><button class="pl'+(!rc.collapsible?' on':'')+'" data-bl="collapsible" data-bv="false">否</button></div></div><div class="sr"><label>默认折叠</label><div class="pls"><button class="pl'+(rc.defaultCollapsed?' on':'')+'" data-bl="defaultCollapsed" data-bv="true">是</button><button class="pl'+(!rc.defaultCollapsed?' on':'')+'" data-bl="defaultCollapsed" data-bv="false">否</button></div></div></div>';
  h+='<div class="ss"><h4>预设样式</h4><div class="pgr">'+Object.keys(window.STYLE_PRESETS).map(function(n){var p=window.STYLE_PRESETS[n];return '<div class="pc'+(rc.preset===n?' on':'')+'" data-ps="'+E(n)+'"><div class="pcn">'+E(n)+'</div><div class="pcd">'+E(p.desc)+'</div></div>'}).join('')+'</div></div>';
  h+='<div class="ss"><h4>原子样式</h4>'+AC.map(function(c){return '<div class="ag"><div class="agt">'+c.t+'</div><div class="acs">'+c.a.map(function(a){return '<span class="ac'+(cur[a]?' on':'')+'" data-at="'+a+'">'+a+'</span>'}).join('')+'</div></div>'}).join('')+'</div>';
  h+='<div class="ss"><h4>CSS 覆盖</h4>'+[['color','Color'],['backgroundColor','Background'],['fontSize','Font Size'],['padding','Padding'],['border','Border'],['borderLeft','Border Left'],['borderRadius','Radius'],['fontFamily','Font'],['fontWeight','Weight'],['lineHeight','Line Height'],['boxShadow','Shadow']].map(function(p){return '<div class="sr"><label>'+p[1]+'</label><input type="text" data-cs="'+p[0]+'" value="'+E((rc.style&&rc.style[p[0]])||'')+'"></div>'}).join('')+'</div>';
  sted.innerHTML=h;

  var dl=sted.querySelector('#stDl');if(dl)dl.addEventListener('click',function(){if(confirm('删除?')){delete cfg[ty];eType=null;sted.innerHTML='<div class="ste0">← 选择类型</div>';bSL();stPv.innerHTML=''}});
  sted.querySelectorAll('[data-f]').forEach(function(i){i.addEventListener('input',function(){cfg[ty][i.getAttribute('data-f')]=i.value;uPv()})});
  sted.querySelectorAll('[data-ly]').forEach(function(b){b.addEventListener('click',function(){cfg[ty].layout=b.getAttribute('data-ly');b.parentElement.querySelectorAll('.pl').forEach(function(x){x.classList.remove('on')});b.classList.add('on');uPv()})});
  sted.querySelectorAll('[data-bl]').forEach(function(b){b.addEventListener('click',function(){cfg[ty][b.getAttribute('data-bl')]=b.getAttribute('data-bv')==='true';b.parentElement.querySelectorAll('.pl').forEach(function(x){x.classList.remove('on')});b.classList.add('on');uPv()})});
  sted.querySelectorAll('.pc').forEach(function(c){c.addEventListener('click',function(){var n=c.getAttribute('data-ps');var p=window.STYLE_PRESETS[n];if(!p)return;cfg[ty].preset=n;cfg[ty].atoms=p.atoms.slice();cfg[ty].style={};eST(ty)})});
  sted.querySelectorAll('.ac').forEach(function(ch){ch.addEventListener('click',function(){var a=ch.getAttribute('data-at');if(!cfg[ty].atoms)cfg[ty].atoms=[];var at=cfg[ty].atoms;var ca=AC.find(function(c){return c.a.indexOf(a)>-1});if(ca){ca.a.forEach(function(o){var i=at.indexOf(o);if(i>-1)at.splice(i,1)});ch.parentElement.querySelectorAll('.ac').forEach(function(x){x.classList.remove('on')})}var i=at.indexOf(a);if(i>-1){at.splice(i,1);ch.classList.remove('on')}else{at.push(a);ch.classList.add('on')}cfg[ty].preset=null;sted.querySelectorAll('.pc').forEach(function(x){x.classList.remove('on')});uPv()})});
  sted.querySelectorAll('[data-cs]').forEach(function(i){i.addEventListener('input',function(){if(!cfg[ty].style)cfg[ty].style={};var k=i.getAttribute('data-cs');if(i.value)cfg[ty].style[k]=i.value;else delete cfg[ty].style[k];uPv()})});
  uPv();
}

function uPv(){
  if(!eType)return;var rc=cfg[eType],st=cS(rc);stPv.removeAttribute('style');stPv.innerHTML='';stPv.className='pmc';Object.assign(stPv.style,st);
  var cp=rc.component||'text',mk=MK[cp]||MK.text;
  if(cp==='markdown'){stPv.classList.add('md');try{stPv.innerHTML=marked.parse(mk,{breaks:true,gfm:true});stPv.querySelectorAll('pre code').forEach(function(b){hljs.highlightElement(b)})}catch(e){stPv.textContent=mk}}
  else if(cp==='code'){stPv.innerHTML='<pre style="margin:0;background:transparent;border:none;padding:0"><code>'+E(mk)+'</code></pre>';try{stPv.querySelectorAll('code').forEach(function(b){hljs.highlightElement(b)})}catch(e){}}
  else if(cp==='terminal'){stPv.style.whiteSpace='pre-wrap';stPv.style.fontFamily='var(--mono)';stPv.textContent=mk}
  else if(cp==='json'){try{stPv.innerHTML='<pre style="margin:0;background:transparent;border:none;padding:0"><code class="language-json">'+E(JSON.stringify(JSON.parse(mk),null,2))+'</code></pre>';stPv.querySelectorAll('code').forEach(function(b){hljs.highlightElement(b)})}catch(e){stPv.textContent=mk}}
  else if(cp==='table'){try{var d=JSON.parse(mk);if(Array.isArray(d)){var ks=Object.keys(d[0]);stPv.innerHTML='<table style="border-collapse:collapse;width:100%;font-size:12px"><tr>'+ks.map(function(k){return '<th style="border:1px solid var(--border);padding:6px 8px;background:var(--bg);font-weight:600">'+E(k)+'</th>'}).join('')+'</tr>'+d.map(function(r){return '<tr>'+ks.map(function(k){return '<td style="border:1px solid var(--border);padding:6px 8px">'+E(String(r[k]))+'</td>'}).join('')+'</tr>'}).join('')+'</table>'}}catch(e){}}
  else stPv.textContent=mk;
}

$('stSav').addEventListener('click',function(){sC();toast('已保存','ok')});
$('stRst').addEventListener('click',function(){if(confirm('恢复默认？')){cfg=JSON.parse(JSON.stringify(window.RENDERER_CONFIG));localStorage.removeItem('ac_cfg');if(eType)eST(eType);toast('已恢复')}});
$('stExp').addEventListener('click',function(){var j='const RENDERER_CONFIG = '+JSON.stringify(cfg,null,2)+';';var a=document.createElement('a');a.href=URL.createObjectURL(new Blob([j],{type:'application/javascript'}));a.download='renderer_config.js';a.click();toast('已导出','ok')});

setEmpty(!cC()||!(cC().messages||[]).length);

/* Typewriter multilingual animation */
var twPhrases=[
  '需要我为你做些什么？',
  'What can I do for you?',
  '何かお手伝いできますか？',
  'Was kann ich für Sie tun?',
  '무엇을 도와드릴까요?',
  'Que puis-je faire pour vous ?',
  'Чем могу помочь?',
  'ما الذي يمكنني مساعدتك به؟'
];
var twEl=$('wlHL'),twIdx=0,twCharIdx=0,twDir=1,twTimer=null,twPause=0;
function twTick(){
  if(!twEl)return;
  var phrase=twPhrases[twIdx];
  var cur=twEl.querySelector('.wl-cursor');
  if(twDir===1){
    twCharIdx++;
    twEl.textContent=phrase.slice(0,twCharIdx);
    if(cur)twEl.appendChild(cur);else{var c=document.createElement('span');c.className='wl-cursor';twEl.appendChild(c)}
    if(twCharIdx>=phrase.length){twDir=0;twPause=30;/* pause ~2.4s at 80ms */}
    twTimer=setTimeout(twTick,40+Math.random()*40);
  }else if(twDir===0){
    twPause--;
    if(twPause<=0){twDir=-1}
    twTimer=setTimeout(twTick,80);
  }else{
    twCharIdx--;
    twEl.textContent=phrase.slice(0,twCharIdx);
    if(cur)twEl.appendChild(cur);else{var c=document.createElement('span');c.className='wl-cursor';twEl.appendChild(c)}
    if(twCharIdx<=0){twDir=1;twIdx=(twIdx+1)%twPhrases.length;twTimer=setTimeout(twTick,500);return}
    twTimer=setTimeout(twTick,25);
  }
}
twTick();

uIn.focus();bSL();
})();
</script>
</body>
</html>
