<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
<title>AgentChat</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Source+Code+Pro:wght@400;500;600&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
<style>
:root{--white:#fff;--bg:#f7f7f8;--bg2:#ededf0;--bg3:#e3e3e6;--border:#e5e5e7;--blt:#f0f0f2;--t1:#111;--t2:#444;--t3:#777;--t4:#aaa;--t5:#ccc;--accent:#2563eb;--abg:#dbeafe;--green:#16a34a;--red:#dc2626;--font:'DM Sans','Noto Sans SC',system-ui,sans-serif;--mono:'Source Code Pro','Fira Code',ui-monospace,monospace}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;width:100%;overflow:hidden;background:var(--white);color:var(--t1);font-family:var(--font);font-size:14px;line-height:1.6;-webkit-font-smoothing:antialiased}
button{font-family:inherit;cursor:pointer;border:none;background:none;outline:none}
input,select,textarea{font-family:inherit;outline:none}

/* === APP SHELL === */
#app{width:100%;height:100vh;display:flex;flex-direction:column;overflow:hidden}
#nav{height:48px;flex:0 0 48px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;background:var(--white);border-bottom:1px solid var(--border);z-index:100}
.nl{display:flex;align-items:center;gap:4px}
.brand{display:flex;align-items:center;gap:8px;font-size:15px;font-weight:700;color:var(--t1);letter-spacing:-.3px;padding-right:14px;margin-right:6px;border-right:1px solid var(--border);user-select:none}
.brand i{width:24px;height:24px;border-radius:6px;background:var(--t1);display:flex;align-items:center;justify-content:center}
.brand i svg{width:14px;height:14px}
.ntab{display:flex;align-items:center;gap:5px;padding:6px 12px;font-size:13px;font-weight:500;color:var(--t3);border-radius:6px;transition:all .15s}
.ntab:hover{color:var(--t2);background:var(--bg)}
.ntab.on{color:var(--t1);background:var(--bg2)}
.ntab svg{width:15px;height:15px;opacity:.5}
.ntab.on svg{opacity:.8}
.nr{display:flex;align-items:center;gap:2px}
.nb{display:flex;align-items:center;justify-content:center;width:34px;height:34px;color:var(--t4);border-radius:6px;transition:all .15s}
.nb:hover{color:var(--t2);background:var(--bg)}
.nb.on{color:var(--accent);background:var(--abg)}
.nb svg{width:16px;height:16px}
.nsep{width:1px;height:20px;background:var(--border);margin:0 4px}

/* === BODY: holds pages === */
#body{flex:1 1 0%;position:relative;overflow:hidden}

/* Pages: absolute fill, visibility toggle to avoid display conflicts */
.pg{position:absolute;top:0;left:0;right:0;bottom:0;visibility:hidden;pointer-events:none}
.pg[data-on="1"]{visibility:visible;pointer-events:auto}

/* === CHAT PAGE === */
.pg-chat{display:flex;flex-direction:row}
.hsb{width:240px;flex:0 0 240px;background:var(--bg);border-right:1px solid var(--border);display:flex;flex-direction:column}
.hsh{padding:12px 14px;display:flex;align-items:center;justify-content:space-between;flex:0 0 auto}
.hsh h3{font-size:12px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.5px}
.sb{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;color:var(--t3);transition:all .12s}
.sb:hover{background:var(--bg3);color:var(--t1)}
.sb svg{width:15px;height:15px}
.hsl{flex:1 1 0%;overflow-y:auto;padding:0 8px 8px}
.hsl::-webkit-scrollbar{width:4px}
.hsl::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.hi{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:6px;font-size:13px;color:var(--t2);cursor:pointer;transition:all .1s;margin-bottom:2px}
.hi:hover{background:var(--bg2);color:var(--t1)}
.hi.on{background:var(--white);color:var(--t1);box-shadow:0 1px 2px rgba(0,0,0,.04);font-weight:500}
.hit{flex:1 1 0%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hid{display:none;flex:0 0 20px;height:20px;align-items:center;justify-content:center;border-radius:4px;color:var(--t4);font-size:12px}
.hi:hover .hid{display:flex}
.hid:hover{color:var(--red);background:rgba(220,38,38,.08)}

/* Chat main */
.cmain{flex:1 1 0%;display:flex;flex-direction:column;min-width:0;overflow:hidden}
.msgs{flex:1 1 0%;overflow-y:auto;overflow-x:hidden}
.msgs::-webkit-scrollbar{width:6px}
.msgs::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.wl{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:40px 24px}
.wl h2{font-size:24px;font-weight:700;color:var(--t1);margin-bottom:6px;letter-spacing:-.5px}
.wl p{color:var(--t3);font-size:14px;max-width:340px;line-height:1.7;margin-bottom:18px}
.wsc-r{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
.wsc{padding:6px 14px;background:var(--bg);border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--t2);cursor:pointer;transition:all .12s}
.wsc:hover{border-color:var(--t4);color:var(--t1);background:var(--white)}

/* Messages */
.msg{padding:20px 0;position:relative;animation:mi .25s ease}
.msg+.msg{border-top:1px solid var(--blt)}
@keyframes mi{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
.mi{max-width:760px;margin:0 auto;padding:0 28px;display:flex;gap:14px}
.msg.user .mi{justify-content:flex-end}
.msg.user .mb{background:var(--bg);padding:10px 16px;border-radius:18px 18px 4px 18px;max-width:70%;word-break:break-word}
.msg.assistant .mi{align-items:flex-start}
.mav{width:26px;height:26px;border-radius:50%;background:var(--t1);display:flex;align-items:center;justify-content:center;flex:0 0 26px;margin-top:2px}
.mav svg{width:14px;height:14px}
.mb{flex:1 1 0%;min-width:0}
.mt{font-size:11px;color:var(--t5);max-width:760px;margin:4px auto 0;padding:0 28px 0 68px}
.mfs{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:8px}
.mfc{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;background:var(--bg);border:1px solid var(--border);border-radius:6px;font-size:12px;color:var(--t2)}

/* Msg hover actions */
.macts{display:none;position:absolute;top:12px;right:12px;background:var(--white);border:1px solid var(--border);border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,.06);padding:2px;gap:1px;z-index:5}
.msg.assistant:hover .macts{display:flex}
.mab{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:4px;color:var(--t4);transition:all .1s}
.mab:hover{color:var(--t2);background:var(--bg)}
.mab svg{width:14px;height:14px}

/* Content blocks */
.cb{margin:6px 0;border-radius:10px;overflow:hidden;word-break:break-word}
.cb:first-child{margin-top:0}
.cbl{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:600;color:var(--t4);text-transform:uppercase;letter-spacing:.3px;margin-bottom:4px;user-select:none}
.cbl.clk{cursor:pointer}
.cbl .ar{font-size:9px;transition:transform .2s;display:inline-block}
.cbl .ar.d{transform:rotate(0)}.cbl .ar.r{transform:rotate(-90deg)}
.cbd{overflow:hidden;transition:max-height .3s ease,opacity .2s}
.cbd.col{max-height:0!important;opacity:0;padding:0!important}

/* Code copy */
.cw{position:relative}
.cc{position:absolute;top:8px;right:8px;padding:3px 8px;background:rgba(255,255,255,.85);border:1px solid var(--border);border-radius:4px;font-size:11px;font-weight:500;color:var(--t3);opacity:0;transition:all .15s;backdrop-filter:blur(4px);z-index:2;cursor:pointer}
.cw:hover .cc{opacity:1}
.cc:hover{color:var(--t1);background:var(--white)}
.cc.ok{color:var(--green);border-color:var(--green)}

/* Markdown */
.md h1,.md h2,.md h3,.md h4{margin:14px 0 6px;font-weight:600;color:var(--t1)}
.md h1{font-size:1.35em}.md h2{font-size:1.2em}.md h3{font-size:1.05em}
.md p{margin:5px 0}.md ul,.md ol{padding-left:20px;margin:5px 0}.md li{margin:2px 0}
.md code{font-family:var(--mono);background:var(--bg2);padding:1px 5px;border-radius:4px;font-size:.88em}
.md pre{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:12px 14px;overflow-x:auto;margin:8px 0}
.md pre code{background:none;padding:0;font-size:13px;line-height:1.55}
.md a{color:var(--accent);text-decoration:none}.md a:hover{text-decoration:underline}
.md blockquote{border-left:3px solid var(--border);padding-left:14px;color:var(--t2);margin:8px 0}
.md table{border-collapse:collapse;width:100%;margin:8px 0;font-size:13px}
.md th,.md td{border:1px solid var(--border);padding:7px 10px;text-align:left}
.md th{background:var(--bg);font-weight:600}.md img{max-width:100%;border-radius:10px}

/* Streaming dot */
.sdot::after{content:'';display:inline-block;width:6px;height:6px;background:var(--accent);border-radius:50%;margin-left:4px;animation:dp 1s infinite;vertical-align:middle}
@keyframes dp{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.6)}}

/* Input area */
.ina{padding:10px 28px 16px;flex:0 0 auto}
.inw{max-width:760px;margin:0 auto}
.inb{background:var(--white);border:1.5px solid var(--border);border-radius:14px;transition:border-color .2s,box-shadow .2s}
.inb:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,.06)}
.inb.dov{border-color:var(--accent);background:var(--abg)}
.fp{display:flex;flex-wrap:wrap;gap:5px;padding:8px 14px 0}
.fp:empty{display:none}
.ft{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;background:var(--bg);border-radius:6px;font-size:12px;color:var(--t2)}
.ftx{color:var(--t4);font-size:14px;cursor:pointer;line-height:1}.ftx:hover{color:var(--red)}
.inr{display:flex;align-items:flex-end;padding:8px 8px 8px 14px;gap:4px}
.ita{flex:1 1 0%;border:none;background:transparent;color:var(--t1);font-size:14px;line-height:1.55;resize:none;min-height:24px;max-height:180px;padding:4px 0;font-family:inherit}
.ita::placeholder{color:var(--t4)}
.iac{display:flex;align-items:center;gap:1px;flex:0 0 auto}
.ib{width:34px;height:34px;display:flex;align-items:center;justify-content:center;color:var(--t4);border-radius:6px;transition:all .12s}
.ib:hover{background:var(--bg);color:var(--t2)}
.ib svg{width:17px;height:17px}
.sbtn{width:34px;height:34px;display:flex;align-items:center;justify-content:center;background:var(--t1);color:var(--white);border-radius:10px;transition:all .15s}
.sbtn:hover{background:#333}
.sbtn:disabled{background:var(--border);color:var(--t5);cursor:not-allowed}
.sbtn svg{width:15px;height:15px}
.inh{text-align:center;padding:5px 0 0;font-size:11px;color:var(--t5)}

/* Terminal panel */
.tp{position:fixed;top:48px;right:0;width:420px;height:calc(100vh - 48px);background:#1a1a2e;transform:translateX(100%);transition:transform .35s ease;z-index:50;display:flex;flex-direction:column;box-shadow:-2px 0 20px rgba(0,0,0,.1)}
.tp.open{transform:translateX(0)}
.tbar{display:flex;align-items:center;justify-content:space-between;padding:0 14px;height:40px;flex:0 0 40px;background:#141428;border-bottom:1px solid #2a2a4a}
.tbar h3{font-size:12px;font-weight:600;color:#7777aa;font-family:var(--mono);display:flex;align-items:center;gap:8px}
.td{display:flex;gap:5px}.tdd{width:10px;height:10px;border-radius:50%}.tdd.r{background:#ff5f57}.tdd.y{background:#febc2e}.tdd.g{background:#28c840}
.tc{color:#555577;font-size:18px;padding:4px}.tc:hover{color:#ccc}
.tbd{flex:1 1 0%;overflow-y:auto;padding:12px 14px;font-family:var(--mono);font-size:13px;line-height:1.55;color:#d1d5db;white-space:pre-wrap;word-break:break-all}
.tbd::-webkit-scrollbar{width:5px}.tbd::-webkit-scrollbar-thumb{background:#333;border-radius:3px}
.tl{margin:1px 0}.tl.cmd{color:#4ade80}.tl.err{color:#f87171}

/* API popover */
.apop{position:fixed;top:52px;right:16px;background:var(--white);border:1px solid var(--border);border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.12);padding:16px;width:360px;z-index:200;display:none}
.apop.open{display:block}
.ar2{display:flex;align-items:center;gap:6px;margin-bottom:8px}
.ar2:last-of-type{margin-bottom:0}
.ar2 label{font-size:12px;color:var(--t3);width:60px;flex:0 0 60px;font-weight:500}
.ar2 input,.ar2 select{flex:1 1 0%;height:30px;padding:0 8px;background:var(--bg);border:1px solid var(--border);border-radius:6px;font-size:12px;color:var(--t1);font-family:var(--mono)}
.ar2 input:focus{border-color:var(--accent)}
.anote{font-size:11px;color:var(--t3);margin-top:10px;line-height:1.6;background:var(--bg);padding:8px 10px;border-radius:6px}
.anote code{font-family:var(--mono);background:var(--white);padding:1px 4px;border-radius:3px;font-size:10px;border:1px solid var(--border)}

/* === STUDIO PAGE === */
.pg-stu{display:flex;flex-direction:row;background:var(--bg)}
.stside{width:200px;flex:0 0 200px;background:var(--white);border-right:1px solid var(--border);display:flex;flex-direction:column}
.stsh{padding:14px 16px;border-bottom:1px solid var(--border);flex:0 0 auto}
.stsh h3{font-size:11px;font-weight:700;color:var(--t4);text-transform:uppercase;letter-spacing:.6px}
.stl{flex:1 1 0%;overflow-y:auto;padding:6px 8px}
.stl::-webkit-scrollbar{width:4px}.stl::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.si{display:flex;align-items:center;gap:6px;padding:7px 10px;font-size:13px;color:var(--t2);cursor:pointer;border-radius:6px;border-left:3px solid transparent;transition:all .1s;margin-bottom:1px}
.si:hover{background:var(--bg);color:var(--t1)}
.si.on{background:rgba(37,99,235,.06);color:var(--accent);border-left-color:var(--accent);font-weight:500}
.sii{font-size:11px;width:18px;text-align:center;flex:0 0 18px}
.siad{color:var(--accent);font-weight:500}
.stf{padding:8px;border-top:1px solid var(--border);flex:0 0 auto;display:flex;flex-direction:column;gap:2px}
.sfb{display:flex;align-items:center;gap:6px;padding:7px 10px;font-size:12px;font-weight:500;color:var(--t3);border-radius:6px;transition:all .12s}
.sfb:hover{background:var(--bg);color:var(--t1)}
.sfb svg{width:14px;height:14px;opacity:.5}

/* Studio editor */
.sted{flex:1 1 0%;overflow-y:auto;padding:24px 28px;min-width:0}
.sted::-webkit-scrollbar{width:6px}.sted::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.ste0{display:flex;align-items:center;justify-content:center;height:100%;color:var(--t4)}
.ss{margin-bottom:24px}
.ss h4{font-size:11px;font-weight:700;color:var(--t4);text-transform:uppercase;letter-spacing:.6px;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--blt)}
.sr{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.sr label{font-size:12px;color:var(--t2);width:80px;flex:0 0 80px;font-weight:500}
.sr input[type="text"],.sr select{flex:1 1 0%;height:32px;padding:0 10px;background:var(--white);border:1px solid var(--border);color:var(--t1);border-radius:6px;font-size:12px;transition:border-color .15s}
.sr input:focus,.sr select:focus{border-color:var(--accent)}
.pls{display:flex;gap:3px;flex:1 1 0%;flex-wrap:wrap}
.pl{padding:5px 12px;font-size:12px;border:1px solid var(--border);background:var(--white);color:var(--t2);border-radius:6px;font-weight:500;transition:all .1s}
.pl:hover{border-color:var(--t4)}
.pl.on{background:var(--accent);border-color:var(--accent);color:var(--white)}
.pgr{display:grid;grid-template-columns:repeat(auto-fill,minmax(125px,1fr));gap:6px}
.pc{padding:8px 10px;border:1.5px solid var(--border);border-radius:6px;cursor:pointer;transition:all .12s;text-align:center;background:var(--white)}
.pc:hover{border-color:var(--t4)}
.pc.on{border-color:var(--accent);background:var(--abg)}
.pcn{font-size:12px;font-weight:600;color:var(--t1)}.pcd{font-size:10px;color:var(--t3);margin-top:1px}
.ag{margin-bottom:10px}.agt{font-size:11px;color:var(--t3);margin-bottom:4px;font-weight:500}
.acs{display:flex;flex-wrap:wrap;gap:4px}
.ac{padding:3px 9px;font-size:11px;border:1px solid var(--border);border-radius:999px;cursor:pointer;color:var(--t2);background:var(--white);transition:all .1s;font-family:var(--mono)}
.ac:hover{border-color:var(--t4)}
.ac.on{background:var(--accent);border-color:var(--accent);color:var(--white)}

/* Studio preview */
.stpv{width:360px;flex:0 0 360px;background:var(--white);border-left:1px solid var(--border);display:flex;flex-direction:column}
.stph{padding:14px 18px;border-bottom:1px solid var(--border);flex:0 0 auto}
.stph h3{font-size:11px;font-weight:700;color:var(--t4);text-transform:uppercase;letter-spacing:.6px}
.stpb{flex:1 1 0%;overflow-y:auto;padding:20px 18px}
.pml{font-size:11px;color:var(--t5);margin-bottom:10px;font-weight:500}
.pmm{display:flex;gap:10px;align-items:flex-start}
.pma{width:22px;height:22px;border-radius:50%;background:var(--t1);flex:0 0 22px;margin-top:2px}
.pmc{flex:1 1 0%;min-width:0}

/* Toast */
.tw{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column-reverse;gap:8px;pointer-events:none}
.to{padding:10px 16px;background:var(--t1);color:var(--white);font-size:13px;font-weight:500;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.15);animation:ti .3s ease;max-width:320px;pointer-events:auto}
.to.ok{background:#059669}.to.err{background:var(--red)}
@keyframes ti{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* Responsive */
@media(max-width:900px){.hsb{display:none}.tp{width:100vw}.mi{padding:0 16px}.ina{padding:8px 12px 12px}.macts{display:none!important}.stpv{display:none}.stside{width:160px;flex:0 0 160px}.pgr{grid-template-columns:1fr 1fr}.mt{padding:0 16px}.apop{right:8px;width:calc(100vw - 16px)}}
</style>
</head>
<body>
<div id="app">
<div id="nav">
  <div class="nl">
    <div class="brand"><i><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></i>AgentChat</div>
    <button class="ntab on" data-pg="chat"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>ÂØπËØù</button>
    <button class="ntab" data-pg="stu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>Ê∏≤ÊüìÂô®</button>
  </div>
  <div class="nr">
    <button class="nb" id="bApi" title="API"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg></button>
    <button class="nb" id="bTrm" title="ÁªàÁ´Ø"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg></button>
    <span class="nsep"></span>
    <button class="nb" id="bExp" title="ÂØºÂá∫"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></button>
  </div>
</div>
<div class="apop" id="apop">
  <div class="ar2"><label>Endpoint</label><input id="cfgUrl" value="/v1/chat/completions"></div>
  <div class="ar2"><label>Model</label><input id="cfgModel" value="" placeholder="model name"></div>
  <div class="ar2"><label>Stream</label><select id="cfgStream"><option value="true" selected>Yes</option><option value="false">No</option></select></div>
  <div class="anote"><strong>Ë∑®ÂüüÔºü</strong> Áî® <code>python serve.py --api http://IP:PORT</code> ÂêØÂä®ÔºåEndpoint Â°´ <code>/api/v1/chat/completions</code>ÔºåËá™Âä®‰ª£ÁêÜËΩ¨Âèë„ÄÇ</div>
</div>
<div id="body">
  <!-- CHAT -->
  <div class="pg pg-chat" id="pgChat" data-on="1">
    <div class="hsb"><div class="hsh"><h3>ÂéÜÂè≤ÂØπËØù</h3><button class="sb" id="bNew" title="Êñ∞ÂØπËØù"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button></div><div class="hsl" id="hsl"></div></div>
    <div class="cmain">
      <div class="msgs" id="msgs"><div class="wl" id="wl"><h2>AgentChat</h2><p>ËæìÂÖ•Ê∂àÊÅØÊàñ‰∏ä‰º†Êñá‰ª∂ÂºÄÂßãÂØπËØù„ÄÇ</p><div class="wsc-r"><span class="wsc" data-q="‰Ω†Â•ΩÔºå‰ªãÁªç‰∏Ä‰∏ã‰Ω†Ëá™Â∑±">üëã Êâì‰∏™ÊãõÂëº</span><span class="wsc" data-q="Â∏ÆÊàëÂÜô‰∏ÄÊÆµ Python Âø´ÈÄüÊéíÂ∫è">üêç ÂÜôÊÆµ‰ª£Á†Å</span><span class="wsc" data-q="Áî® JSON ËøîÂõû‰∏ñÁïåÂâç5Â§ßÂüéÂ∏Ç">üìä ÁªìÊûÑÂåñÊï∞ÊçÆ</span></div></div></div>
      <div class="ina"><div class="inw"><div class="inb" id="inb"><div class="fp" id="fp"></div><div class="inr"><textarea class="ita" id="uIn" rows="1" placeholder="ËæìÂÖ•Ê∂àÊÅØ‚Ä¶"></textarea><div class="iac"><button class="ib" id="bAt" title="‰∏ä‰º†"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg></button><button class="sbtn" id="sBtn" title="ÂèëÈÄÅ"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div></div></div><div class="inh">Enter ÂèëÈÄÅ ¬∑ Shift+Enter Êç¢Ë°å ¬∑ ÊãñÊãΩ/Á≤òË¥¥‰∏ä‰º†Êñá‰ª∂</div></div></div>
      <input type="file" id="fIn" multiple style="display:none">
    </div>
  </div>
  <!-- STUDIO -->
  <div class="pg pg-stu" id="pgStu" data-on="0">
    <div class="stside"><div class="stsh"><h3>Content Types</h3></div><div class="stl" id="stl"></div><div class="stf"><button class="sfb" id="stExp"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>ÂØºÂá∫</button><button class="sfb" id="stRst"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>ÊÅ¢Â§çÈªòËÆ§</button><button class="sfb" id="stSav" style="color:var(--accent);font-weight:600"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>‰øùÂ≠ò</button></div></div>
    <div class="sted" id="sted"><div class="ste0">‚Üê ÈÄâÊã©‰∏Ä‰∏™ content_type ÂºÄÂßãÁºñËæë</div></div>
    <div class="stpv"><div class="stph"><h3>ÂÆûÊó∂È¢ÑËßà</h3></div><div class="stpb"><div class="pml">Ê∏≤ÊüìÊïàÊûú</div><div class="pmm"><div class="pma"></div><div class="pmc" id="stPv"></div></div></div></div>
  </div>
</div>
</div>
<div class="tp" id="tp"><div class="tbar"><h3><span class="td"><span class="tdd r"></span><span class="tdd y"></span><span class="tdd g"></span></span>Terminal</h3><button class="tc" id="tCl">‚úï</button></div><div class="tbd" id="tbd"></div></div>
<div class="tw" id="tw"></div>
<script src="renderer_config.js"></script>
<script>
(function(){
"use strict";
var $=function(i){return document.getElementById(i)};
var E=function(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML};
var G=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)};
var T=function(){return new Date().toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'})};

var msgs=$('msgs'),wl=$('wl'),uIn=$('uIn'),sBtn=$('sBtn'),inb=$('inb'),fIn=$('fIn'),fp=$('fp');
var tp=$('tp'),tbd=$('tbd'),cfgUrl=$('cfgUrl'),cfgModel=$('cfgModel'),cfgStream=$('cfgStream'),apop=$('apop');
var hsl=$('hsl'),stl=$('stl'),sted=$('sted'),stPv=$('stPv');

var cfg=JSON.parse(JSON.stringify(window.RENDERER_CONFIG));
var cvs=[],aid=null,fls=[],strm=false,pOpen=false,eType=null;

try{var _c=localStorage.getItem('ac_cfg');if(_c)cfg=JSON.parse(_c)}catch(e){}
try{var _h=localStorage.getItem('ac_cvs');if(_h)cvs=JSON.parse(_h)}catch(e){}
try{aid=localStorage.getItem('ac_aid')||null}catch(e){}
function sC(){try{localStorage.setItem('ac_cfg',JSON.stringify(cfg))}catch(e){}}
function sV(){try{localStorage.setItem('ac_cvs',JSON.stringify(cvs));localStorage.setItem('ac_aid',aid||'')}catch(e){}}
function gR(t){return cfg[t]||cfg._default||{component:'text',layout:'inline',atoms:[],style:{}}}
function cS(r){return window.resolveStyle?window.resolveStyle(r):(r.style||{})}

function toast(m,t){var e=document.createElement('div');e.className='to'+(t==='ok'?' ok':'')+(t==='err'?' err':'');e.textContent=m;$('tw').appendChild(e);setTimeout(function(){e.style.opacity='0';e.style.transition='opacity .2s';setTimeout(function(){e.remove()},200)},2500)}

/* Page switch */
document.querySelectorAll('.ntab[data-pg]').forEach(function(tab){
  tab.addEventListener('click',function(){
    document.querySelectorAll('.ntab').forEach(function(t){t.classList.remove('on')});tab.classList.add('on');
    document.querySelectorAll('.pg').forEach(function(p){p.setAttribute('data-on','0')});
    var id=tab.dataset.pg==='chat'?'pgChat':'pgStu';
    $(id).setAttribute('data-on','1');
    if(tab.dataset.pg==='stu')bSL();
  });
});

/* API popover */
$('bApi').addEventListener('click',function(e){e.stopPropagation();apop.classList.toggle('open');$('bApi').classList.toggle('on')});
document.addEventListener('click',function(e){if(!apop.contains(e.target)){apop.classList.remove('open');$('bApi').classList.remove('on')}});

/* Terminal */
function tgl(f){pOpen=f!==undefined?f:!pOpen;tp.classList.toggle('open',pOpen);$('bTrm').classList.toggle('on',pOpen)}
function tP(t,ty){if(!pOpen)tgl(true);var e=document.createElement('div');e.className='tl'+(ty==='bash'?' cmd':'')+(ty==='stderr'?' err':'');if(ty==='bash')e.innerHTML='<span style="color:#4ade80">$ </span>'+E(t);else e.textContent=t;tbd.appendChild(e);tbd.scrollTop=tbd.scrollHeight}
$('bTrm').addEventListener('click',function(){tgl()});
$('tCl').addEventListener('click',function(){tgl(false)});

/* Files */
function aF(fl){for(var i=0;i<fl.length;i++){var f=fl[i];if(!fls.some(function(a){return a.name===f.name&&a.size===f.size}))fls.push(f)}rF()}
function rF(){fp.innerHTML='';fls.forEach(function(f,i){var t=document.createElement('span');t.className='ft';t.innerHTML=E(f.name)+'<button class="ftx" data-i="'+i+'">‚úï</button>';t.querySelector('.ftx').addEventListener('click',function(){fls.splice(i,1);rF()});fp.appendChild(t)})}
function b64(f){return new Promise(function(r,j){var rd=new FileReader();rd.onload=function(){r(rd.result.split(',')[1])};rd.onerror=function(){j(new Error('r'))};rd.readAsDataURL(f)})}
inb.addEventListener('dragover',function(e){e.preventDefault();inb.classList.add('dov')});
inb.addEventListener('dragleave',function(){inb.classList.remove('dov')});
inb.addEventListener('drop',function(e){e.preventDefault();inb.classList.remove('dov');if(e.dataTransfer.files.length)aF(e.dataTransfer.files)});
$('bAt').addEventListener('click',function(){fIn.click()});
fIn.addEventListener('change',function(){if(fIn.files.length)aF(fIn.files);fIn.value=''});
uIn.addEventListener('paste',function(e){var it=e.clipboardData?e.clipboardData.items:null;if(!it)return;var fs=[];for(var i=0;i<it.length;i++)if(it[i].kind==='file')fs.push(it[i].getAsFile());if(fs.length)aF(fs)});

function sB(){requestAnimationFrame(function(){msgs.scrollTop=msgs.scrollHeight})}

/* History */
function cC(){return cvs.find(function(c){return c.id===aid})}
function nC(){var c={id:G(),title:'Êñ∞ÂØπËØù',messages:[],ts:Date.now()};cvs.unshift(c);aid=c.id;sV();rH();clr();return c}
function dC(id){cvs=cvs.filter(function(c){return c.id!==id});if(aid===id){aid=cvs.length?cvs[0].id:null;if(aid)lC(aid);else{clr();wl.style.display=''}}sV();rH()}
function lC(id){aid=id;sV();rH();var c=cC();if(!c)return;msgs.innerHTML='';msgs.appendChild(wl);if(!c.messages.length){wl.style.display='';return}wl.style.display='none';c.messages.forEach(function(m){if(m.role==='user')uD(m.content,m.files);else aD(m.content)});sB()}
function clr(){msgs.innerHTML='';msgs.appendChild(wl);wl.style.display='';tbd.innerHTML=''}
function rH(){
  hsl.innerHTML='';
  if(!cvs.length){hsl.innerHTML='<div style="padding:20px 10px;font-size:12px;color:var(--t4);text-align:center">ÊöÇÊó†ÂØπËØù</div>';return}
  cvs.forEach(function(c){var e=document.createElement('div');e.className='hi'+(c.id===aid?' on':'');e.innerHTML='<span class="hit">'+E(c.title)+'</span><span class="hid" title="Âà†Èô§">‚úï</span>';e.querySelector('.hit').addEventListener('click',function(){lC(c.id)});e.querySelector('.hid').addEventListener('click',function(ev){ev.stopPropagation();dC(c.id)});hsl.appendChild(e)});
}
$('bNew').addEventListener('click',function(){nC()});
rH();if(aid&&cvs.find(function(c){return c.id===aid}))lC(aid);

/* Message DOM */
function uD(t,fl){
  wl.style.display='none';var r=document.createElement('div');r.className='msg user';
  var fh='';if(fl&&fl.length)fh='<div class="mfs">'+fl.map(function(f){return '<span class="mfc">üìé '+E(typeof f==='string'?f:f.name)+'</span>'}).join('')+'</div>';
  r.innerHTML='<div class="mi"><div class="mb">'+fh+E(typeof t==='string'?t:'')+'</div></div>';msgs.appendChild(r);sB();
}
function aD(t){
  wl.style.display='none';var r=document.createElement('div');r.className='msg assistant';
  r.innerHTML='<div class="mi"><div class="mav"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div><div class="mb md"></div></div><div class="mt">'+T()+'</div>';
  var bd=r.querySelector('.mb');try{bd.innerHTML=marked.parse(t,{breaks:true,gfm:true});bd.querySelectorAll('pre code').forEach(function(b){hljs.highlightElement(b)});aCB(bd)}catch(e){bd.textContent=t}msgs.appendChild(r);sB();
}
function cBub(){
  wl.style.display='none';var r=document.createElement('div');r.className='msg assistant';
  r.innerHTML='<div class="macts"><button class="mab mcp" title="Â§çÂà∂"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></div><div class="mi"><div class="mav"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div><div class="mb"></div></div><div class="mt">'+T()+'</div>';
  msgs.appendChild(r);sB();var bd=r.querySelector('.mb');
  r.querySelector('.mcp').addEventListener('click',function(){navigator.clipboard.writeText(bd.textContent).then(function(){toast('Â∑≤Â§çÂà∂','ok')})});
  return bd;
}
function aCB(el){
  el.querySelectorAll('pre').forEach(function(pre){if(pre.parentElement.classList.contains('cw'))return;var w=document.createElement('div');w.className='cw';pre.parentNode.insertBefore(w,pre);w.appendChild(pre);var b=document.createElement('button');b.className='cc';b.textContent='Â§çÂà∂';b.addEventListener('click',function(){navigator.clipboard.writeText(pre.textContent).then(function(){b.textContent='Â∑≤Â§çÂà∂';b.classList.add('ok');setTimeout(function(){b.textContent='Â§çÂà∂';b.classList.remove('ok')},1500)})});w.appendChild(b)});
}

/* Content blocks */
function gB(ctn,ty,bks){
  if(bks[ty])return bks[ty];var rc=gR(ty);
  if(rc.layout==='panel'){bks[ty]={panel:true,rc:rc,buf:''};return bks[ty]}
  var w=document.createElement('div');w.className='cb';
  var sl=rc.icon||(rc.label&&rc.label!=='Ê≠£Êñá'&&rc.label!=='ÈªòËÆ§');
  if(sl){var lb=document.createElement('div');lb.className='cbl'+(rc.collapsible?' clk':'');lb.innerHTML=(rc.collapsible?'<span class="ar '+(rc.defaultCollapsed?'r':'d')+'">‚ñæ</span>':'')+(rc.icon?'<span>'+rc.icon+'</span>':'')+'<span>'+(rc.label||ty)+'</span>';w.appendChild(lb);if(rc.collapsible)lb.addEventListener('click',function(){var bd=lb.nextElementSibling;var ar=lb.querySelector('.ar');var cl=!bd.classList.contains('col');bd.classList.toggle('col',cl);ar.className='ar '+(cl?'r':'d')})}
  var bd=document.createElement('div');bd.className='cbd'+(rc.component==='markdown'?' md':'')+(rc.defaultCollapsed?' col':'');Object.assign(bd.style,cS(rc));if(rc.maxHeight){bd.style.maxHeight=rc.maxHeight;bd.style.overflowY='auto'}w.appendChild(bd);ctn.appendChild(w);bks[ty]={el:bd,rc:rc,buf:''};return bks[ty];
}
function pC(bi,c,s){
  if(!c)return;
  if(bi.panel){var pt=bi.rc.label==='ÂëΩ‰ª§'?'bash':bi.rc.label==='ÈîôËØØËæìÂá∫'?'stderr':'stdout';tP(c,pt);bi.buf+=c;return}
  bi.buf+=c;var el=bi.el,rc=bi.rc;
  switch(rc.component){
    case 'markdown':try{el.innerHTML=marked.parse(bi.buf,{breaks:true,gfm:true});el.querySelectorAll('pre code').forEach(function(b){hljs.highlightElement(b)});aCB(el)}catch(e){el.textContent=bi.buf}if(s){var la=el.lastElementChild||el;if(!la.querySelector('.sdd')){var d=document.createElement('span');d.className='sdd sdot';la.appendChild(d)}}break;
    case 'code':var pre=el.querySelector('pre');if(!pre){pre=document.createElement('pre');var cd=document.createElement('code');pre.appendChild(cd);el.innerHTML='';el.appendChild(pre)}pre.querySelector('code').textContent=bi.buf;try{hljs.highlightElement(pre.querySelector('code'))}catch(e){}el.classList.toggle('sdot',!!s);break;
    case 'terminal':el.style.fontFamily='var(--mono)';el.style.whiteSpace='pre-wrap';el.textContent=bi.buf;el.classList.toggle('sdot',!!s);break;
    case 'json':try{var o=JSON.parse(bi.buf);var p2=el.querySelector('pre');if(!p2){p2=document.createElement('pre');var c2=document.createElement('code');c2.className='language-json';p2.appendChild(c2);el.innerHTML='';el.appendChild(p2)}p2.querySelector('code').textContent=JSON.stringify(o,null,2);try{hljs.highlightElement(p2.querySelector('code'))}catch(e){}}catch(e){el.style.fontFamily='var(--mono)';el.textContent=bi.buf}el.classList.toggle('sdot',!!s);break;
    case 'html':var fr=el.querySelector('iframe');if(!fr){fr=document.createElement('iframe');fr.sandbox='allow-scripts';fr.style.cssText='width:100%;border:none;border-radius:8px;background:#fff;min-height:60px';el.innerHTML='';el.appendChild(fr)}fr.srcdoc=bi.buf;break;
    case 'image':var im=el.querySelector('img');if(!im){im=document.createElement('img');im.style.cssText='max-width:100%;border-radius:12px';el.innerHTML='';el.appendChild(im)}im.src=bi.buf.startsWith('data:')||bi.buf.startsWith('http')?bi.buf:'data:image/png;base64,'+bi.buf.trim();break;
    case 'table':try{var d=JSON.parse(bi.buf);if(Array.isArray(d)&&d.length){var ks=Object.keys(d[0]);el.innerHTML='<table style="border-collapse:collapse;width:100%;font-size:13px"><tr>'+ks.map(function(k){return '<th style="border:1px solid var(--border);padding:7px 10px;background:var(--bg);font-weight:600;text-align:left">'+E(k)+'</th>'}).join('')+'</tr>'+d.map(function(r){return '<tr>'+ks.map(function(k){return '<td style="border:1px solid var(--border);padding:7px 10px">'+E(String(r[k]!=null?r[k]:''))+'</td>'}).join('')+'</tr>'}).join('')+'</table>'}}catch(e){el.textContent=bi.buf}break;
    default:el.textContent=bi.buf;el.classList.toggle('sdot',!!s);
  }sB();
}
function clC(c){c.querySelectorAll('.sdot').forEach(function(e){e.classList.remove('sdot')});c.querySelectorAll('.sdd').forEach(function(e){e.remove()})}

/* Send */
function send(){
  var t=uIn.value.trim();if((!t&&!fls.length)||strm)return;uIn.value='';uIn.style.height='auto';
  var c=cC();if(!c)c=nC();var mf=fls.slice();fls=[];rF();uD(t,mf);
  c.messages.push({role:'user',content:t,files:mf.map(function(f){return f.name})});
  if(c.title==='Êñ∞ÂØπËØù'&&t)c.title=t.slice(0,30);sV();rH();
  var url=cfgUrl.value.trim(),mod=cfgModel.value.trim(),st=cfgStream.value==='true';
  var am=c.messages.map(function(m){return{role:m.role,content:m.content}});
  var body=JSON.stringify({model:mod,messages:am,stream:st});
  strm=true;sBtn.disabled=true;var bub=cBub(),bks={};
  var opts={method:'POST',headers:{'Content-Type':'application/json'},body:body};
  (st?doSSE(url,opts,bub,bks):doJSON(url,opts,bub,bks)).catch(function(err){if(err.name!=='AbortError'){var b=gB(bub,'error',bks);pC(b,'ËØ∑Ê±ÇÂ§±Ë¥•: '+err.message,false)}}).finally(function(){strm=false;sBtn.disabled=false;clC(bub);var full='';Object.keys(bks).forEach(function(k){if(!bks[k].panel)full+=bks[k].buf+'\n'});full=full.trim();if(full){c.messages.push({role:'assistant',content:full});sV()}});
}
function doSSE(url,opts,bub,bks){
  return fetch(url,opts).then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);var rd=r.body.getReader(),dc=new TextDecoder(),bf='';
    function pump(){return rd.read().then(function(res){if(res.done)return;bf+=dc.decode(res.value,{stream:true});var ls=bf.split('\n');bf=ls.pop();
      for(var i=0;i<ls.length;i++){var l=ls[i].trim();if(!l||l.indexOf('data: ')!==0)continue;var d=l.slice(6);if(d==='[DONE]')return;
        try{var ch=JSON.parse(d).choices[0];if(!ch)continue;var dt=ch.delta||{};var ct=dt.content_type||'text';if(ch.finish_reason==='stop')return;if(dt.content){var bi=gB(bub,ct,bks);pC(bi,dt.content,true)}}catch(e){}}return pump()})}return pump()});
}
function doJSON(url,opts,bub,bks){
  return fetch(url,opts).then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.json()}).then(function(data){var ch=data.choices?data.choices[0]:null;if(!ch)return;var ct=(ch.delta?ch.delta.content_type:null)||'text';var cn=(ch.delta?ch.delta.content:null)||(ch.message?ch.message.content:null)||'';var bi=gB(bub,ct,bks);pC(bi,cn,false)});
}

/* Export */
$('bExp').addEventListener('click',function(){var c=cC();if(!c||!c.messages.length){toast('Ê≤°ÊúâÂØπËØù','err');return}var md='# '+c.title+'\n\n';c.messages.forEach(function(m){md+='### '+(m.role==='user'?'üë§':'ü§ñ')+'\n\n'+m.content+'\n\n---\n\n'});var a=document.createElement('a');a.href=URL.createObjectURL(new Blob([md],{type:'text/markdown'}));a.download='chat-'+c.id+'.md';a.click();toast('Â∑≤ÂØºÂá∫','ok')});

/* Welcome shortcuts */
document.querySelectorAll('.wsc').forEach(function(e){e.addEventListener('click',function(){uIn.value=e.getAttribute('data-q');send()})});

/* Input */
uIn.addEventListener('keydown',function(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send()}});
uIn.addEventListener('input',function(){uIn.style.height='auto';uIn.style.height=Math.min(uIn.scrollHeight,180)+'px'});
sBtn.addEventListener('click',function(){send()});
document.addEventListener('keydown',function(e){var m=e.metaKey||e.ctrlKey;if(m&&e.key==='k'){e.preventDefault();uIn.focus()}if(m&&e.key==='n'){e.preventDefault();nC()}});

/* ======== STUDIO ======== */
var MK={text:"Á§∫‰æãÊñáÊú¨„ÄÇThe quick brown fox jumps over the lazy dog.",markdown:"## Ê†áÈ¢ò\n\n**Á≤ó‰Ωì**Ê≠£ÊñáÔºåÂê´ `‰ª£Á†Å`„ÄÇ\n\n- ÂàóË°®‰∏Ä\n- ÂàóË°®‰∫å\n\n> ÂºïÁî®\n\n```python\ndef hello():\n    print('world')\n```",code:"async function fetch(url) {\n  const res = await fetch(url);\n  return await res.json();\n}",terminal:"$ pip install pandas\nCollecting pandas\nSuccessfully installed pandas-2.2.0",json:'{"status":"ok","data":{"count":42}}',html:"<p>HTML</p>",image:"",table:'[{"Name":"Alice","Score":95},{"Name":"Bob","Score":87}]',hidden:"(hidden)"};
var AC=[{t:'Â≠ó‰ΩìÂ§ßÂ∞è',a:['text-xs','text-sm','text-base','text-lg','text-xl']},{t:'Â≠óÈáç',a:['font-light','font-normal','font-medium','font-semibold','font-bold']},{t:'Â≠ó‰ΩìÊóè',a:['font-sans','font-mono','font-serif']},{t:'ÊñáÂ≠óÈ¢úËâ≤',a:['color-primary','color-secondary','color-muted','color-accent','color-success','color-warning','color-danger','color-white','color-term-green','color-term-gray','color-term-red']},{t:'ËÉåÊôØËâ≤',a:['bg-none','bg-white','bg-gray-50','bg-gray-100','bg-gray-900','bg-blue-50','bg-green-50','bg-amber-50','bg-red-50','bg-purple-50']},{t:'ÂÜÖËæπË∑ù',a:['p-0','p-2','p-3','p-4','p-5']},{t:'ÂúÜËßí',a:['rounded-none','rounded-sm','rounded-md','rounded-lg']},{t:'ËæπÊ°Ü',a:['border','border-l-blue','border-l-green','border-l-amber','border-l-red','border-l-purple','border-l-gray']},{t:'Ë°åÈ´ò',a:['leading-tight','leading-normal','leading-relaxed']},{t:'ÂÖ∂‰ªñ',a:['italic','not-italic','shadow-sm','shadow']}];

function bSL(){
  stl.innerHTML='';var ts=Object.keys(cfg).filter(function(k){return k!=='_default'});ts.unshift('_default');
  ts.forEach(function(t){var rc=cfg[t];var e=document.createElement('div');e.className='si'+(t===eType?' on':'');e.innerHTML='<span class="sii">'+(rc.icon||'¬∑')+'</span><span>'+(t==='_default'?'default':t)+'</span>';e.addEventListener('click',function(){eST(t)});stl.appendChild(e)});
  var ad=document.createElement('div');ad.className='si siad';ad.innerHTML='<span class="sii">+</span><span>Ê∑ªÂä†</span>';
  ad.addEventListener('click',function(){var n=prompt('content_type:');if(n&&!cfg[n]){cfg[n]=JSON.parse(JSON.stringify(cfg._default));cfg[n].label=n;bSL();eST(n)}});stl.appendChild(ad);
}

function eST(ty){
  eType=ty;bSL();var rc=cfg[ty],cur={};(rc.atoms||[]).forEach(function(a){cur[a]=true});
  var h='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px"><div style="font-size:18px;font-weight:700;letter-spacing:-.3px">'+(ty==='_default'?'default':E(ty))+'<span style="margin-left:8px;font-size:13px;font-weight:400;color:var(--t3)">'+E(rc.label||'')+'</span></div>'+(ty!=='_default'?'<button id="stDl" style="font-size:12px;color:var(--red);padding:4px 10px;border:1px solid var(--border);border-radius:6px;cursor:pointer">Âà†Èô§</button>':'')+'</div>';
  h+='<div class="ss"><h4>Âü∫Á°ÄÈÖçÁΩÆ</h4><div class="sr"><label>Label</label><input type="text" data-f="label" value="'+E(rc.label||'')+'"></div><div class="sr"><label>Icon</label><input type="text" data-f="icon" value="'+E(rc.icon||'')+'" style="width:60px;flex:none" placeholder="emoji"></div><div class="sr"><label>ÁªÑ‰ª∂</label><select data-f="component">'+['text','markdown','code','terminal','json','html','image','table','hidden'].map(function(c){return '<option'+(rc.component===c?' selected':'')+'>'+c+'</option>'}).join('')+'</select></div><div class="sr"><label>Â∏ÉÂ±Ä</label><div class="pls">'+['inline','panel'].map(function(l){return '<button class="pl'+(rc.layout===l?' on':'')+'" data-ly="'+l+'">'+(l==='inline'?'üí¨ ÂØπËØù':'üìü Èù¢Êùø')+'</button>'}).join('')+'</div></div><div class="sr"><label>ÂèØÊäòÂè†</label><div class="pls"><button class="pl'+(rc.collapsible?' on':'')+'" data-bl="collapsible" data-bv="true">ÊòØ</button><button class="pl'+(!rc.collapsible?' on':'')+'" data-bl="collapsible" data-bv="false">Âê¶</button></div></div><div class="sr"><label>ÈªòËÆ§ÊäòÂè†</label><div class="pls"><button class="pl'+(rc.defaultCollapsed?' on':'')+'" data-bl="defaultCollapsed" data-bv="true">ÊòØ</button><button class="pl'+(!rc.defaultCollapsed?' on':'')+'" data-bl="defaultCollapsed" data-bv="false">Âê¶</button></div></div></div>';
  h+='<div class="ss"><h4>È¢ÑËÆæÊ†∑Âºè</h4><div class="pgr">'+Object.keys(window.STYLE_PRESETS).map(function(n){var p=window.STYLE_PRESETS[n];return '<div class="pc'+(rc.preset===n?' on':'')+'" data-ps="'+E(n)+'"><div class="pcn">'+E(n)+'</div><div class="pcd">'+E(p.desc)+'</div></div>'}).join('')+'</div></div>';
  h+='<div class="ss"><h4>ÂéüÂ≠êÊ†∑Âºè</h4>'+AC.map(function(c){return '<div class="ag"><div class="agt">'+c.t+'</div><div class="acs">'+c.a.map(function(a){return '<span class="ac'+(cur[a]?' on':'')+'" data-at="'+a+'">'+a+'</span>'}).join('')+'</div></div>'}).join('')+'</div>';
  h+='<div class="ss"><h4>CSS Ë¶ÜÁõñ</h4>'+[['color','Color'],['backgroundColor','Background'],['fontSize','Font Size'],['padding','Padding'],['border','Border'],['borderLeft','Border Left'],['borderRadius','Radius'],['fontFamily','Font'],['fontWeight','Weight'],['lineHeight','Line Height'],['boxShadow','Shadow']].map(function(p){return '<div class="sr"><label>'+p[1]+'</label><input type="text" data-cs="'+p[0]+'" value="'+E((rc.style&&rc.style[p[0]])||'')+'"></div>'}).join('')+'</div>';
  sted.innerHTML=h;

  var dl=sted.querySelector('#stDl');if(dl)dl.addEventListener('click',function(){if(confirm('Âà†Èô§?')){delete cfg[ty];eType=null;sted.innerHTML='<div class="ste0">‚Üê ÈÄâÊã©Á±ªÂûã</div>';bSL();stPv.innerHTML=''}});
  sted.querySelectorAll('[data-f]').forEach(function(i){i.addEventListener('input',function(){cfg[ty][i.getAttribute('data-f')]=i.value;uPv()})});
  sted.querySelectorAll('[data-ly]').forEach(function(b){b.addEventListener('click',function(){cfg[ty].layout=b.getAttribute('data-ly');b.parentElement.querySelectorAll('.pl').forEach(function(x){x.classList.remove('on')});b.classList.add('on');uPv()})});
  sted.querySelectorAll('[data-bl]').forEach(function(b){b.addEventListener('click',function(){cfg[ty][b.getAttribute('data-bl')]=b.getAttribute('data-bv')==='true';b.parentElement.querySelectorAll('.pl').forEach(function(x){x.classList.remove('on')});b.classList.add('on');uPv()})});
  sted.querySelectorAll('.pc').forEach(function(c){c.addEventListener('click',function(){var n=c.getAttribute('data-ps');var p=window.STYLE_PRESETS[n];if(!p)return;cfg[ty].preset=n;cfg[ty].atoms=p.atoms.slice();cfg[ty].style={};eST(ty)})});
  sted.querySelectorAll('.ac').forEach(function(ch){ch.addEventListener('click',function(){var a=ch.getAttribute('data-at');if(!cfg[ty].atoms)cfg[ty].atoms=[];var at=cfg[ty].atoms;var ca=AC.find(function(c){return c.a.indexOf(a)>-1});if(ca){ca.a.forEach(function(o){var i=at.indexOf(o);if(i>-1)at.splice(i,1)});ch.parentElement.querySelectorAll('.ac').forEach(function(x){x.classList.remove('on')})}var i=at.indexOf(a);if(i>-1){at.splice(i,1);ch.classList.remove('on')}else{at.push(a);ch.classList.add('on')}cfg[ty].preset=null;sted.querySelectorAll('.pc').forEach(function(x){x.classList.remove('on')});uPv()})});
  sted.querySelectorAll('[data-cs]').forEach(function(i){i.addEventListener('input',function(){if(!cfg[ty].style)cfg[ty].style={};var k=i.getAttribute('data-cs');if(i.value)cfg[ty].style[k]=i.value;else delete cfg[ty].style[k];uPv()})});
  uPv();
}

function uPv(){
  if(!eType)return;var rc=cfg[eType],st=cS(rc);stPv.removeAttribute('style');stPv.innerHTML='';stPv.className='pmc';Object.assign(stPv.style,st);
  var cp=rc.component||'text',mk=MK[cp]||MK.text;
  if(cp==='markdown'){stPv.classList.add('md');try{stPv.innerHTML=marked.parse(mk,{breaks:true,gfm:true});stPv.querySelectorAll('pre code').forEach(function(b){hljs.highlightElement(b)})}catch(e){stPv.textContent=mk}}
  else if(cp==='code'){stPv.innerHTML='<pre style="margin:0;background:transparent;border:none;padding:0"><code>'+E(mk)+'</code></pre>';try{stPv.querySelectorAll('code').forEach(function(b){hljs.highlightElement(b)})}catch(e){}}
  else if(cp==='terminal'){stPv.style.whiteSpace='pre-wrap';stPv.style.fontFamily='var(--mono)';stPv.textContent=mk}
  else if(cp==='json'){try{stPv.innerHTML='<pre style="margin:0;background:transparent;border:none;padding:0"><code class="language-json">'+E(JSON.stringify(JSON.parse(mk),null,2))+'</code></pre>';stPv.querySelectorAll('code').forEach(function(b){hljs.highlightElement(b)})}catch(e){stPv.textContent=mk}}
  else if(cp==='table'){try{var d=JSON.parse(mk);if(Array.isArray(d)){var ks=Object.keys(d[0]);stPv.innerHTML='<table style="border-collapse:collapse;width:100%;font-size:12px"><tr>'+ks.map(function(k){return '<th style="border:1px solid var(--border);padding:6px 8px;background:var(--bg);font-weight:600">'+E(k)+'</th>'}).join('')+'</tr>'+d.map(function(r){return '<tr>'+ks.map(function(k){return '<td style="border:1px solid var(--border);padding:6px 8px">'+E(String(r[k]))+'</td>'}).join('')+'</tr>'}).join('')+'</table>'}}catch(e){}}
  else stPv.textContent=mk;
}

$('stSav').addEventListener('click',function(){sC();toast('Â∑≤‰øùÂ≠ò','ok')});
$('stRst').addEventListener('click',function(){if(confirm('ÊÅ¢Â§çÈªòËÆ§Ôºü')){cfg=JSON.parse(JSON.stringify(window.RENDERER_CONFIG));localStorage.removeItem('ac_cfg');if(eType)eST(eType);toast('Â∑≤ÊÅ¢Â§ç')}});
$('stExp').addEventListener('click',function(){var j='const RENDERER_CONFIG = '+JSON.stringify(cfg,null,2)+';';var a=document.createElement('a');a.href=URL.createObjectURL(new Blob([j],{type:'application/javascript'}));a.download='renderer_config.js';a.click();toast('Â∑≤ÂØºÂá∫','ok')});

uIn.focus();bSL();
})();
</script>
</body>
</html>
